"use strict";(()=>{var a={};a.id=119,a.ids=[119],a.modules={73:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>h});var e=c(7489),f=c(1046),g=a([e]);e=(g.then?(await g)():g)[0];let i=/^[a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?$/;async function h(a,b){let c=(0,f.RE)(a);if((0,f.at)(a,c),!(0,f.FS)(a,b,["POST"],c))return;let d=(0,f.Y2)(a,c);if(!d.ok)return void(0,f.n4)(b,d.status,d.error,c);let g="string"==typeof d.data.firm_slug?d.data.firm_slug.trim():"";if(!g)return void(0,f.n4)(b,400,"firm_slug is required",c);if(!i.test(g))return void(0,f.n4)(b,400,"Invalid firm_slug format",c);let{data:h,error:j}=await e.supabaseAdmin.from("firms").select("id, name, slug, branding").eq("slug",g).maybeSingle();if(j)return void(0,f.n4)(b,500,"Unable to resolve firm",c);if(!h?.id||!h.name)return void(0,f.n4)(b,404,"Firm not found",c);let k=function(a){if(!a||"object"!=typeof a||Array.isArray(a))return{};let b="string"==typeof a.logo_url&&a.logo_url.trim().length<=512?a.logo_url.trim():void 0,c="string"==typeof a.accent_color&&/^#[0-9A-Fa-f]{6}$/.test(a.accent_color)?a.accent_color:void 0;return{...b?{logo_url:b}:{},...c?{accent_color:c}:{}}}(h.branding);return b.status(200).json({ok:!0,firm_id:h.id,firm_name:h.name,branding:k})}d()}catch(a){d(a)}})},1046:(a,b,c)=>{c.d(b,{FS:()=>i,RE:()=>f,Y2:()=>j,at:()=>g,n4:()=>h});var d=c(5511),e=c.n(d);function f(a){let b=a.headers["x-request-id"]??a.headers["x-correlation-id"];if(Array.isArray(b)){let a=b.find(a=>a.trim());if(a)return a.trim()}return"string"==typeof b&&b.trim()?b.trim():e().randomUUID()}function g(a,b){let c=a.url?a.url.split("?")[0]:"";console.info(`[intake-api] ${a.method??"UNKNOWN"} ${c} requestId=${b}`)}function h(a,b,c,d,e){let f=e?` detail="${e}"`:"";return console.error(`[intake-api] requestId=${d} status=${b} message="${c}"${f}`),a.status(b).json({ok:!1,error:c,requestId:d})}function i(a,b,c,d){return!!a.method&&!!c.includes(a.method)||(b.setHeader("Allow",c),h(b,405,"Method not allowed",d),!1)}function j(a,b,c={}){let d=c.limitBytes??1048576,e=a.body??(c.allowEmpty?{}:void 0);if(void 0===e)return{ok:!1,status:400,error:"Request body required"};if("string"==typeof e){if(Buffer.byteLength(e,"utf8")>d)return{ok:!1,status:413,error:"Request body too large"};try{return{ok:!0,data:JSON.parse(e)}}catch{return{ok:!1,status:400,error:"Invalid JSON body"}}}return Buffer.byteLength(JSON.stringify(e),"utf8")>d?{ok:!1,status:413,error:"Request body too large"}:{ok:!0,data:e}}},2043:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>o,default:()=>n,handler:()=>m});var e=c(1223),f=c(4600),g=c(4409),h=c(6440),i=c(73),j=c(9275),k=c(879),l=a([i]);i=(l.then?(await l)():l)[0];let n=(0,h.M)(i,"default"),o=(0,h.M)(i,"config"),p=new g.PagesAPIRouteModule({definition:{kind:f.A.PAGES_API,page:"/api/intake/resolve-firm",pathname:"/api/intake/resolve-firm",bundlePath:"",filename:""},userland:i,distDir:".next",relativeProjectDir:""});async function m(a,b,c){let d=await p.prepare(a,b,{srcPage:"/api/intake/resolve-firm"});if(!d){b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve());return}let{query:f,params:g,prerenderManifest:h,routerServerContext:i}=d;try{let c=a.method||"GET",d=(0,j.getTracer)(),e=d.getActiveScopeSpan(),l=p.instrumentationOnRequestError.bind(p),m=async e=>p.render(a,b,{query:{...f,...g},params:g,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:h.preview,propagateError:!1,dev:p.isDev,page:"/api/intake/resolve-firm",internalRevalidate:null==i?void 0:i.revalidate,onError:(...b)=>l(a,...b)}).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let f=d.getRootSpanAttributes();if(!f)return;if(f.get("next.span_type")!==k.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${f.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let g=f.get("next.route");if(g){let a=`${c} ${g}`;e.setAttributes({"next.route":g,"http.route":g,"next.span_name":a}),e.updateName(a)}else e.updateName(`${c} ${a.url}`)});e?await m(e):await d.withPropagatedContext(a.headers,()=>d.trace(k.BaseServerSpan.handleRequest,{spanName:`${c} ${a.url}`,kind:j.SpanKind.SERVER,attributes:{"http.method":c,"http.target":a.url}},m))}catch(a){if(p.isDev)throw a;(0,e.sendError)(b,500,"Internal Server Error")}finally{null==c.waitUntil||c.waitUntil.call(c,Promise.resolve())}}d()}catch(a){d(a)}})},3721:a=>{a.exports=import("@supabase/supabase-js")},5511:a=>{a.exports=require("crypto")},5600:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7489:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{supabaseAdmin:()=>i});var e=c(3721),f=a([e]);e=(f.then?(await f)():f)[0];let g=process.env.SUPABASE_URL,h=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!g||!h)throw console.error("Missing SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY",{hasUrl:!!g,hasKey:!!h}),Error("Missing SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY");let i=(0,e.createClient)(g,h,{auth:{persistSession:!1,autoRefreshToken:!1}});d()}catch(a){d(a)}})}};var b=require("../../../webpack-api-runtime.js");b.C(a);var c=b.X(0,[929],()=>b(b.s=2043));module.exports=c})();