(()=>{var a={};a.id=517,a.ids=[220,517,636],a.modules={361:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},2015:a=>{"use strict";a.exports=require("react")},2326:a=>{"use strict";a.exports=require("react-dom")},3873:a=>{"use strict";a.exports=require("path")},3939:a=>{"use strict";a.exports=require("@supabase/supabase-js")},4075:a=>{"use strict";a.exports=require("zlib")},4687:(a,b,c)=>{"use strict";c.r(b),c.d(b,{config:()=>z,default:()=>v,getServerSideProps:()=>y,getStaticPaths:()=>x,getStaticProps:()=>w,handler:()=>H,reportWebVitals:()=>A,routeModule:()=>G,unstable_getServerProps:()=>E,unstable_getServerSideProps:()=>F,unstable_getStaticParams:()=>D,unstable_getStaticPaths:()=>C,unstable_getStaticProps:()=>B});var d={};c.r(d),c.d(d,{default:()=>t});var e=c(2636),f=c(4850),g=c(3410),h=c(9382),i=c(2627),j=c(8732),k=c(9247),l=c.n(k),m=c(953),n=c.n(m),o=c(2015),p=c(6955),q=c(484),r=c(5833);let s=[{value:7,label:"Last 7 days"},{value:30,label:"Last 30 days"},{value:90,label:"Last 90 days"}];function t(){let{state:a}=(0,p._)(),[b,c]=(0,o.useState)(90),[d,e]=(0,o.useState)([]),[f,g]=(0,o.useState)(!1),[h,i]=(0,o.useState)(null),k=(0,r.jR)(a.role),m=(0,o.useMemo)(()=>{let a=new Date;return a.setDate(a.getDate()-b),a.toISOString()},[b]),t=async()=>{if(!a.firmId||!k)return;let{data:c,error:d}=await q.N.from("case_activity").select("created_at, event_type, message, case_id, actor_user_id").eq("firm_id",a.firmId).gte("created_at",m).order("created_at",{ascending:!1}).limit(1e3);if(d)return void i(d.message);let e=["created_at","event_type","message","case_id","actor_user_id"],f=new Blob([[e.join(","),...(c??[]).map(a=>e.map(b=>{let c=a[b],d=null==c?"":String(c);return`"${d.replace(/"/g,'""')}"`}).join(","))].join("\n")],{type:"text/csv"}),g=URL.createObjectURL(f),h=document.createElement("a");h.href=g,h.download=`verilex-activity-${b}d.csv`,h.click(),URL.revokeObjectURL(g)};return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(l(),{children:(0,j.jsx)("title",{children:"MyClient | Activity"})}),(0,j.jsxs)("div",{className:"mx-auto max-w-6xl rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-8 shadow-sm",children:[(0,j.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,j.jsx)(n(),{href:"/myclient/app",className:"text-sm text-[color:var(--muted)] hover:text-white transition",children:"â† Back"}),(0,j.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Activity"})]}),(0,j.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"Recent firm activity and exports."}),!a.authed&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Please sign in."}),a.authed&&!a.firmId&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"No firm linked yet."}),a.authed&&a.firmId&&!k&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Admin only. Contact your admin for access."}),a.authed&&a.firmId&&k&&(0,j.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,j.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,j.jsx)("label",{htmlFor:"rangeDays",className:"sr-only",children:"Select date range"}),(0,j.jsx)("select",{id:"rangeDays",value:b,onChange:a=>c(Number(a.target.value)),className:"rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:s.map(a=>(0,j.jsx)("option",{value:a.value,children:a.label},a.value))}),(0,j.jsx)("button",{onClick:t,className:"rounded-lg border border-[color:var(--border)] px-4 py-2 text-xs font-semibold uppercase tracking-wide text-[color:var(--muted)] hover:text-white",children:"Export CSV"})]}),h&&(0,j.jsx)("div",{className:"rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:h}),(0,j.jsx)("div",{className:"overflow-hidden rounded-2xl border border-[color:var(--border)]",children:f?(0,j.jsx)("p",{className:"px-4 py-6 text-[color:var(--muted)]",children:"Loading..."}):0===d.length?(0,j.jsx)("p",{className:"px-4 py-6 text-[color:var(--muted)]",children:"No activity for this range."}):(0,j.jsx)("ul",{className:"divide-y divide-white/10",children:d.map(a=>(0,j.jsx)("li",{className:"px-4 py-4",children:(0,j.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,j.jsxs)("div",{children:[a.case_id?(0,j.jsx)(n(),{href:`/myclient/cases/${a.case_id}`,className:"text-white hover:text-[color:var(--accent-soft)]",children:a.message}):(0,j.jsx)("p",{className:"text-white",children:a.message}),(0,j.jsx)("p",{className:"text-xs text-[color:var(--muted-2)]",children:new Date(a.created_at).toLocaleString()})]}),(0,j.jsx)("span",{className:"rounded-full border border-[color:var(--border)] px-2 py-1 text-xs uppercase tracking-wide text-[color:var(--muted)]",children:a.event_type})]})},a.id))})})]})]})]})}var u=c(6104);let v=(0,g.M)(d,"default"),w=(0,g.M)(d,"getStaticProps"),x=(0,g.M)(d,"getStaticPaths"),y=(0,g.M)(d,"getServerSideProps"),z=(0,g.M)(d,"config"),A=(0,g.M)(d,"reportWebVitals"),B=(0,g.M)(d,"unstable_getStaticProps"),C=(0,g.M)(d,"unstable_getStaticPaths"),D=(0,g.M)(d,"unstable_getStaticParams"),E=(0,g.M)(d,"unstable_getServerProps"),F=(0,g.M)(d,"unstable_getServerSideProps"),G=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/myclient/activity",pathname:"/myclient/activity",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:i.default,Document:h.default},userland:d}),H=(0,u.U)({srcPage:"/myclient/activity",config:z,userland:d,routeModule:G,getStaticPaths:x,getStaticProps:w,getServerSideProps:y})},5833:(a,b,c)=>{"use strict";function d(a){if("string"!=typeof a)return null;let b=a.toLowerCase();return"admin"===b||"attorney"===b||"staff"===b?b:null}function e(a){let b=d(a);return"admin"===b||"attorney"===b}function f(a){let b=d(a);return"admin"===b||"attorney"===b}function g(a){let b=d(a);return"admin"===b||"attorney"===b}function h(a){return"admin"===d(a)}c.d(b,{TX:()=>f,Ue:()=>e,gL:()=>g,jR:()=>h})},6060:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},7910:a=>{"use strict";a.exports=require("stream")},8732:a=>{"use strict";a.exports=require("react/jsx-runtime")},9021:a=>{"use strict";a.exports=require("fs")},9247:(a,b,c)=>{a.exports=c(6186)},9382:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>f});var d=c(8732),e=c(6030);function f(){return(0,d.jsxs)(e.Html,{lang:"en",children:[(0,d.jsx)(e.Head,{children:(0,d.jsx)("link",{rel:"icon",href:"/favicon.svg",type:"image/svg+xml"})}),(0,d.jsxs)("body",{children:[(0,d.jsx)(e.Main,{}),(0,d.jsx)(e.NextScript,{})]})]})}}};var b=require("../../webpack-runtime.js");b.C(a);var c=b.X(0,[978,708,30,791,627],()=>b(b.s=4687));module.exports=c})();