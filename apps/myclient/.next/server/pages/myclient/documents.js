(()=>{var a={};a.id=959,a.ids=[220,636,959],a.modules={361:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},1409:(a,b,c)=>{"use strict";c.r(b),c.d(b,{config:()=>B,default:()=>x,getServerSideProps:()=>A,getStaticPaths:()=>z,getStaticProps:()=>y,handler:()=>J,reportWebVitals:()=>C,routeModule:()=>I,unstable_getServerProps:()=>G,unstable_getServerSideProps:()=>H,unstable_getStaticParams:()=>F,unstable_getStaticPaths:()=>E,unstable_getStaticProps:()=>D});var d={};c.r(d),c.d(d,{default:()=>v});var e=c(2636),f=c(4850),g=c(3410),h=c(9382),i=c(2627),j=c(8732),k=c(9247),l=c.n(k),m=c(953),n=c.n(m),o=c(2015),p=c(6955),q=c(484),r=c(5833),s=c(8688),t=c(2889),u=c(3209);function v(){let{state:a}=(0,p._)(),{plan:b,loading:c}=(0,t.b)(),[d,e]=(0,o.useState)([]),[f,g]=(0,o.useState)([]),[h,i]=(0,o.useState)(!1),[k,m]=(0,o.useState)(null),[v,w]=(0,o.useState)(""),[x,y]=(0,o.useState)(null),[z,A]=(0,o.useState)("all"),[B,C]=(0,o.useState)(""),[D,E]=(0,o.useState)(null),[F,G]=(0,o.useState)(""),[H,I]=(0,o.useState)("other"),[J,K]=(0,o.useState)(""),[L,M]=(0,o.useState)(null),[N,O]=(0,o.useState)(null),P=(0,r.TX)(a.role),Q=(0,r.gL)(a.role),R=(0,u.nh)({plan:b,currentDocumentCount:d.length}),S=!c&&!R.ok,T=a=>{if(!a)return!1;let b=a.toLowerCase();return b.includes("permission")||b.includes("policy")||b.includes("not allowed")},U=(0,o.useMemo)(()=>{let a=new Map;return f.forEach(b=>a.set(b.id,b)),a},[f]),V=(0,o.useMemo)(()=>Array.from(new Set(d.map(a=>a.doc_type).filter(Boolean))).sort(),[d]),W=(0,o.useMemo)(()=>{let a=v.trim().toLowerCase(),b=B.trim().toLowerCase();return d.filter(c=>("all"===z||c.doc_type===z)&&(!a||!!(c.display_name||c.filename).toLowerCase().includes(a))&&(!b||!!c.tags.map(a=>a.toLowerCase()).includes(b))&&!0)},[d,v,z,B]),X=async a=>{y(a),m(null);try{let b=d.find(b=>b.id===a);if(!b?.storage_path)return void m("Document is missing a storage path.");let{data:c,error:e}=await q.N.storage.from("case-documents").createSignedUrl(b.storage_path,60);if(e||!c?.signedUrl)return void m(e?.message||"Unable to generate download link.");window.open(c.signedUrl,"_blank","noopener,noreferrer")}catch(a){m(a instanceof Error?a.message:"Unable to download document.")}finally{y(null)}},Y=async b=>{if(O(null),M(null),!P)return void M("You don’t have permission to perform this action. Please contact your firm admin.");let c=J.split(",").map(a=>a.trim()).filter(a=>a.length>0),f=d.find(a=>a.id===b),{error:g}=await q.N.from("case_documents").update({display_name:F.trim()||null,doc_type:H,tags:c}).eq("id",b);if(g)return void M(T(g.message)?"You don’t have permission to perform this action. Please contact your firm admin.":g.message);e(a=>a.map(a=>a.id===b?{...a,display_name:F.trim()||null,doc_type:H,tags:c}:a)),f&&((f.display_name||f.filename)!==F.trim()&&await (0,s.M)(q.N,{firm_id:a.firmId,case_id:f.case_id,actor_user_id:a.userId,event_type:"document_renamed",message:`Document renamed: ${f.display_name||f.filename} → ${F.trim()}`,metadata:{document_id:b}}),(f.doc_type!==H||f.tags.join(",")!==c.join(","))&&await (0,s.M)(q.N,{firm_id:a.firmId,case_id:f.case_id,actor_user_id:a.userId,event_type:"document_updated",message:`Document updated: ${F.trim()||f.filename}`,metadata:{document_id:b}})),O("Saved"),E(null)},Z=async a=>{if(O(null),M(null),!Q)return void M("You don’t have permission to perform this action. Please contact your firm admin.");if(!window.confirm("Delete this document? This cannot be undone."))return;let{data:b,error:c}=await q.N.auth.getSession();if(c||!b.session?.access_token)return void M(c?.message||"Please sign in.");let d=await fetch("/api/myclient/documents/delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.session.access_token}`},body:JSON.stringify({documentId:a})}),f=await d.json().catch(()=>({}));if(!d.ok||!f.ok)return void M(T(f.error)?"You don’t have permission to perform this action. Please contact your firm admin.":f.error||"Unable to delete document.");e(b=>b.filter(b=>b.id!==a)),O("Deleted")};return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(l(),{children:(0,j.jsx)("title",{children:"MyClient | Documents"})}),(0,j.jsxs)("div",{className:"mx-auto max-w-6xl rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-8 shadow-sm",children:[(0,j.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,j.jsx)(n(),{href:"/myclient/app",className:"text-sm text-[color:var(--muted)] hover:text-white transition",children:"← Back"}),(0,j.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Documents"})]}),(0,j.jsxs)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:["Firm ",a.firmId?a.firmId.slice(0,8):"No firm"," \xb7 Role ",a.role??"member"]}),a.loading&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Loading..."}),!a.loading&&!a.authed&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Please sign in."}),!a.loading&&a.authed&&!a.firmId&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"No firm linked yet."}),a.authed&&a.firmId&&(0,j.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,j.jsxs)("div",{className:"grid gap-3 sm:grid-cols-3",children:[(0,j.jsx)("input",{value:v,onChange:a=>w(a.target.value),placeholder:"Search by filename",className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-2 text-sm text-[color:var(--text)] placeholder:text-[color:var(--muted-2)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"}),(0,j.jsx)("label",{htmlFor:"docTypeFilter",className:"sr-only",children:"Filter by document type"}),(0,j.jsxs)("select",{id:"docTypeFilter",value:z,onChange:a=>A(a.target.value),className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:[(0,j.jsx)("option",{value:"all",children:"Type: All"}),V.map(a=>(0,j.jsx)("option",{value:a,children:a},a))]}),(0,j.jsx)("input",{value:B,onChange:a=>C(a.target.value),placeholder:"Filter by tag",className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-2 text-sm text-[color:var(--text)] placeholder:text-[color:var(--muted-2)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),k&&(0,j.jsx)("div",{className:"rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:k}),L&&(0,j.jsx)("div",{className:"rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:L}),N&&(0,j.jsx)("div",{className:"rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-2 text-sm text-white",children:N}),S&&(0,j.jsxs)("div",{className:"rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-2 text-sm text-[color:var(--muted)]",children:[R.reason," Upgrade to Pro to upload more documents.",(0,j.jsx)(n(),{href:"/myclient/upgrade",className:"ml-2 text-white underline underline-offset-4",children:"Upgrade"})]}),!P&&(0,j.jsx)("div",{className:"rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-2 text-sm text-[color:var(--muted)]",children:"You have read-only access. Please contact your firm admin to manage documents."}),(0,j.jsx)("div",{className:"overflow-hidden rounded-2xl border border-[color:var(--border)]",children:h?(0,j.jsx)("p",{className:"px-4 py-6 text-[color:var(--muted)]",children:"Loading..."}):0===W.length?(0,j.jsx)("p",{className:"px-4 py-6 text-[color:var(--muted)]",children:"No documents uploaded yet."}):(0,j.jsxs)("table",{className:"min-w-full divide-y divide-white/10 text-left text-sm",children:[(0,j.jsx)("thead",{className:"text-[color:var(--muted)]",children:(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{className:"px-4 py-3 font-semibold",children:"File"}),(0,j.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Case"}),(0,j.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Type"}),(0,j.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Tags"}),(0,j.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Uploaded"}),(0,j.jsx)("th",{className:"px-4 py-3 font-semibold text-right",children:"Action"})]})}),(0,j.jsx)("tbody",{className:"divide-y divide-white/5 text-[color:var(--text-1)]",children:W.map(a=>{let b=U.get(a.case_id),c=b?.title||(b?.client_last_name||b?.client_first_name?`${b?.client_last_name??""}${b?.client_first_name?`, ${b?.client_first_name}`:""}`.trim():"Unknown case"),d=a.display_name||a.filename,e=a.tags.length>0?a.tags.slice(0,2).join(", "):"—";return(0,j.jsxs)("tr",{children:[(0,j.jsx)("td",{className:"px-4 py-3 text-white",children:D===a.id?(0,j.jsx)("input",{value:F,onChange:a=>G(a.target.value),disabled:!P,className:"w-full rounded-md border border-[color:var(--border)] bg-[var(--surface-0)] px-2 py-1 text-sm text-white outline-none",placeholder:"Enter document name"}):d}),(0,j.jsx)("td",{className:"px-4 py-3",children:(0,j.jsx)(n(),{href:`/myclient/cases/${a.case_id}`,className:"text-[color:var(--muted)] hover:text-white",children:c})}),(0,j.jsx)("td",{className:"px-4 py-3 capitalize",children:D===a.id?(0,j.jsx)("input",{value:H,onChange:a=>I(a.target.value),disabled:!P,className:"w-full rounded-md border border-[color:var(--border)] bg-[var(--surface-0)] px-2 py-1 text-sm text-white outline-none",placeholder:"Enter document type"}):a.doc_type}),(0,j.jsx)("td",{className:"px-4 py-3 text-[color:var(--muted)]",children:D===a.id?(0,j.jsx)("input",{value:J,onChange:a=>K(a.target.value),disabled:!P,className:"w-full rounded-md border border-[color:var(--border)] bg-[var(--surface-0)] px-2 py-1 text-sm text-white outline-none",placeholder:"Enter tags (comma-separated)"}):(0,j.jsxs)(j.Fragment,{children:[e,a.tags.length>2&&` +${a.tags.length-2}`]})}),(0,j.jsx)("td",{className:"px-4 py-3 text-[color:var(--muted)]",children:new Date(a.created_at).toLocaleDateString()}),(0,j.jsx)("td",{className:"px-4 py-3 text-right",children:(0,j.jsx)("div",{className:"flex flex-wrap justify-end gap-2",children:D===a.id?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("button",{onClick:()=>Y(a.id),disabled:!P,className:"rounded-lg border border-[color:var(--border)] px-3 py-1.5 text-xs font-semibold uppercase tracking-wide text-[color:var(--muted)] hover:text-white disabled:opacity-50",children:"Save"}),(0,j.jsx)("button",{onClick:()=>E(null),className:"rounded-lg border border-[color:var(--border)] px-3 py-1.5 text-xs uppercase tracking-wide text-[color:var(--muted)] hover:text-white",children:"Cancel"})]}):(0,j.jsxs)(j.Fragment,{children:[P&&(0,j.jsx)("button",{onClick:()=>{E(a.id),G(a.display_name||a.filename),I(a.doc_type||"other"),K(a.tags.join(", ")),O(null),M(null)},className:"rounded-lg border border-[color:var(--border)] px-3 py-1.5 text-xs font-semibold uppercase tracking-wide text-[color:var(--muted)] hover:text-white",children:"Rename/Edit"}),(0,j.jsx)("button",{onClick:()=>X(a.id),disabled:x===a.id,className:"rounded-lg border border-[color:var(--border)] px-3 py-1.5 text-xs font-semibold uppercase tracking-wide text-[color:var(--muted)] hover:text-white disabled:opacity-60",children:x===a.id?"Preparing…":"Download"}),Q&&(0,j.jsx)("button",{onClick:()=>Z(a.id),className:"rounded-lg border border-red-400/40 px-3 py-1.5 text-xs font-semibold uppercase tracking-wide text-red-200 hover:text-white",children:"Delete"})]})})})]},a.id)})})]})})]})]})]})}var w=c(6104);let x=(0,g.M)(d,"default"),y=(0,g.M)(d,"getStaticProps"),z=(0,g.M)(d,"getStaticPaths"),A=(0,g.M)(d,"getServerSideProps"),B=(0,g.M)(d,"config"),C=(0,g.M)(d,"reportWebVitals"),D=(0,g.M)(d,"unstable_getStaticProps"),E=(0,g.M)(d,"unstable_getStaticPaths"),F=(0,g.M)(d,"unstable_getStaticParams"),G=(0,g.M)(d,"unstable_getServerProps"),H=(0,g.M)(d,"unstable_getServerSideProps"),I=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/myclient/documents",pathname:"/myclient/documents",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:i.default,Document:h.default},userland:d}),J=(0,w.U)({srcPage:"/myclient/documents",config:B,userland:d,routeModule:I,getStaticPaths:z,getStaticProps:y,getServerSideProps:A})},2015:a=>{"use strict";a.exports=require("react")},2326:a=>{"use strict";a.exports=require("react-dom")},2889:(a,b,c)=>{"use strict";c.d(b,{b:()=>h});var d=c(2015),e=c(484),f=c(6955);let g="free";function h(){let{state:a}=(0,f._)(),[b,c]=(0,d.useState)({plan:g,loading:!0,error:null});return(0,d.useCallback)(async()=>{if(!a.authed||!a.firmId)return void c({plan:g,loading:!1,error:null});c(a=>({...a,loading:!0,error:null}));let{data:b,error:d}=await e.N.from("firms").select("plan").eq("id",a.firmId).single();if(d)return void c({plan:g,loading:!1,error:d.message});c({plan:b?.plan??g,loading:!1,error:null})},[a.authed,a.firmId]),b}},3209:(a,b,c)=>{"use strict";c.d(b,{HK:()=>d,Z8:()=>f,nh:()=>h,wq:()=>g});let d={free:{maxCases:25,maxMembers:3,maxDocuments:200},pro:null,enterprise:null};function e(a){return null===d[a]}function f(a){return e(a.plan)?{ok:!0}:a.currentCaseCount>=d[a.plan].maxCases?{ok:!1,reason:`Case limit reached for Free plan (${d[a.plan].maxCases}).`}:{ok:!0}}function g(a){return e(a.plan)?{ok:!0}:a.currentMemberCount>=d[a.plan].maxMembers?{ok:!1,reason:`Member limit reached for Free plan (${d[a.plan].maxMembers}).`}:{ok:!0}}function h(a){return e(a.plan)?{ok:!0}:a.currentDocumentCount>=d[a.plan].maxDocuments?{ok:!1,reason:`Document limit reached for Free plan (${d[a.plan].maxDocuments}).`}:{ok:!0}}},3873:a=>{"use strict";a.exports=require("path")},3939:a=>{"use strict";a.exports=require("@supabase/supabase-js")},4075:a=>{"use strict";a.exports=require("zlib")},5833:(a,b,c)=>{"use strict";function d(a){if("string"!=typeof a)return null;let b=a.toLowerCase();return"admin"===b||"attorney"===b||"staff"===b?b:null}function e(a){let b=d(a);return"admin"===b||"attorney"===b}function f(a){let b=d(a);return"admin"===b||"attorney"===b}function g(a){let b=d(a);return"admin"===b||"attorney"===b}function h(a){return"admin"===d(a)}c.d(b,{TX:()=>f,Ue:()=>e,gL:()=>g,jR:()=>h})},6060:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},7910:a=>{"use strict";a.exports=require("stream")},8688:(a,b,c)=>{"use strict";async function d(a,b){try{await a.from("case_activity").insert({firm_id:b.firm_id,case_id:b.case_id??null,actor_user_id:b.actor_user_id??null,event_type:b.event_type,message:b.message,metadata:b.metadata??{}})}catch{}}c.d(b,{M:()=>d})},8732:a=>{"use strict";a.exports=require("react/jsx-runtime")},9021:a=>{"use strict";a.exports=require("fs")},9247:(a,b,c)=>{a.exports=c(6186)},9382:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>f});var d=c(8732),e=c(6030);function f(){return(0,d.jsxs)(e.Html,{lang:"en",children:[(0,d.jsx)(e.Head,{children:(0,d.jsx)("link",{rel:"icon",href:"/favicon.svg",type:"image/svg+xml"})}),(0,d.jsxs)("body",{children:[(0,d.jsx)(e.Main,{}),(0,d.jsx)(e.NextScript,{})]})]})}}};var b=require("../../webpack-runtime.js");b.C(a);var c=b.X(0,[978,708,30,791,627],()=>b(b.s=1409));module.exports=c})();