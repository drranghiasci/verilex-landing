(()=>{var a={};a.id=343,a.ids=[220,343,636],a.modules={361:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},2015:a=>{"use strict";a.exports=require("react")},2326:a=>{"use strict";a.exports=require("react-dom")},2889:(a,b,c)=>{"use strict";c.d(b,{b:()=>h});var d=c(2015),e=c(484),f=c(6955);let g="free";function h(){let{state:a}=(0,f._)(),[b,c]=(0,d.useState)({plan:g,loading:!0,error:null});return(0,d.useCallback)(async()=>{if(!a.authed||!a.firmId)return void c({plan:g,loading:!1,error:null});c(a=>({...a,loading:!0,error:null}));let{data:b,error:d}=await e.N.from("firms").select("plan").eq("id",a.firmId).single();if(d)return void c({plan:g,loading:!1,error:d.message});c({plan:b?.plan??g,loading:!1,error:null})},[a.authed,a.firmId]),b}},3209:(a,b,c)=>{"use strict";c.d(b,{HK:()=>d,Z8:()=>f,nh:()=>h,wq:()=>g});let d={free:{maxCases:25,maxMembers:3,maxDocuments:200},pro:null,enterprise:null};function e(a){return null===d[a]}function f(a){return e(a.plan)?{ok:!0}:a.currentCaseCount>=d[a.plan].maxCases?{ok:!1,reason:`Case limit reached for Free plan (${d[a.plan].maxCases}).`}:{ok:!0}}function g(a){return e(a.plan)?{ok:!0}:a.currentMemberCount>=d[a.plan].maxMembers?{ok:!1,reason:`Member limit reached for Free plan (${d[a.plan].maxMembers}).`}:{ok:!0}}function h(a){return e(a.plan)?{ok:!0}:a.currentDocumentCount>=d[a.plan].maxDocuments?{ok:!1,reason:`Document limit reached for Free plan (${d[a.plan].maxDocuments}).`}:{ok:!0}}},3873:a=>{"use strict";a.exports=require("path")},3939:a=>{"use strict";a.exports=require("@supabase/supabase-js")},4075:a=>{"use strict";a.exports=require("zlib")},5833:(a,b,c)=>{"use strict";function d(a){if("string"!=typeof a)return null;let b=a.toLowerCase();return"admin"===b||"attorney"===b||"staff"===b?b:null}function e(a){let b=d(a);return"admin"===b||"attorney"===b}function f(a){let b=d(a);return"admin"===b||"attorney"===b}function g(a){let b=d(a);return"admin"===b||"attorney"===b}function h(a){return"admin"===d(a)}c.d(b,{TX:()=>f,Ue:()=>e,gL:()=>g,jR:()=>h})},6060:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},6924:(a,b,c)=>{"use strict";c.r(b),c.d(b,{config:()=>A,default:()=>w,getServerSideProps:()=>z,getStaticPaths:()=>y,getStaticProps:()=>x,handler:()=>I,reportWebVitals:()=>B,routeModule:()=>H,unstable_getServerProps:()=>F,unstable_getServerSideProps:()=>G,unstable_getStaticParams:()=>E,unstable_getStaticPaths:()=>D,unstable_getStaticProps:()=>C});var d={};c.r(d),c.d(d,{default:()=>u});var e=c(2636),f=c(4850),g=c(3410),h=c(9382),i=c(2627),j=c(8732),k=c(9247),l=c.n(k),m=c(953),n=c.n(m),o=c(2015),p=c(6955),q=c(484),r=c(5833),s=c(2889),t=c(3209);function u(){let{state:a}=(0,p._)(),{plan:b,loading:c}=(0,s.b)(),[d,e]=(0,o.useState)([]),[f,g]=(0,o.useState)(!1),[h,i]=(0,o.useState)(null),[k,m]=(0,o.useState)(""),[u,v]=(0,o.useState)("attorney"),[w,x]=(0,o.useState)(null),[y,z]=(0,o.useState)([]),[A,B]=(0,o.useState)(!1),[C,D]=(0,o.useState)({}),E=(0,r.jR)(a.role),F=(0,t.wq)({plan:b,currentMemberCount:d.length}),G=!c&&!F.ok,H=(0,o.useMemo)(()=>a.firmId?a.firmId.slice(0,8):"No firm",[a.firmId]),I=async()=>{if(x(null),G)return void x(`${F.reason} Upgrade to Pro to add more members.`);let{data:a,error:b}=await q.N.auth.getSession();if(b||!a.session?.access_token)return void x(b?.message||"Please sign in to invite members.");let c=await fetch("/api/myclient/members/invite",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.session.access_token}`},body:JSON.stringify({email:k,role:u})}),d=await c.json().catch(()=>({}));if(!c.ok||!d.ok)return void x(d.error||"Unable to send invite.");x("Invite sent."),m("");let e=await fetch("/api/myclient/members/pending",{method:"POST",headers:{Authorization:`Bearer ${a.session.access_token}`}}),f=await e.json().catch(()=>({}));e.ok&&f.ok&&z(Array.isArray(f.invites)?f.invites:[])},J=async a=>{if(D(b=>({...b,[a.id]:"Sending…"})),G)return void D(b=>({...b,[a.id]:`${F.reason} Upgrade to Pro.`}));let{data:b,error:c}=await q.N.auth.getSession();if(c||!b.session?.access_token)return void D(b=>({...b,[a.id]:c?.message||"Sign in required"}));let d=await fetch("/api/myclient/members/resend-invite",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.session.access_token}`},body:JSON.stringify({email:a.email,role:a.role})}),e=await d.json().catch(()=>({}));if(!d.ok||!e.ok)return void D(b=>({...b,[a.id]:e.error||"Unable to resend invite."}));D(b=>({...b,[a.id]:"Sent"}))};return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(l(),{children:(0,j.jsx)("title",{children:"MyClient | Members"})}),(0,j.jsxs)("div",{className:"mx-auto max-w-6xl rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-8 shadow-sm",children:[(0,j.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,j.jsx)(n(),{href:"/myclient/app",className:"text-sm text-[color:var(--muted)] hover:text-white transition",children:"← Back"}),(0,j.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Firm Members"})]}),(0,j.jsxs)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:["Firm ",H," \xb7 Role ",a.role??"member"]}),a.loading&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Loading..."}),!a.loading&&!a.authed&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Please sign in."}),!a.loading&&a.authed&&!a.firmId&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"No firm linked yet."}),!a.loading&&a.authed&&a.firmId&&!E&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Member management is admin-only. Please contact an admin for invites or changes."}),h&&(0,j.jsx)("div",{className:"mt-6 rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:h}),a.authed&&a.firmId&&E&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{className:"mt-6 rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-6",children:[(0,j.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Invite team member"}),(0,j.jsx)("p",{className:"mt-1 text-sm text-[color:var(--muted)]",children:"Send an invite to join this firm."}),G&&(0,j.jsxs)("div",{className:"mt-3 rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-[color:var(--muted)]",children:[F.reason," Upgrade to Pro to invite more members.",(0,j.jsx)(n(),{href:"/myclient/upgrade",className:"ml-2 text-white underline underline-offset-4",children:"Upgrade"})]}),(0,j.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-[2fr_1fr_auto]",children:[(0,j.jsx)("input",{type:"email",value:k,onChange:a=>m(a.target.value),disabled:G,placeholder:"teammate@firm.com",className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"}),(0,j.jsxs)("select",{value:u,onChange:a=>v(a.target.value),disabled:G,className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:[(0,j.jsx)("option",{value:"admin",children:"Admin"}),(0,j.jsx)("option",{value:"attorney",children:"Attorney"}),(0,j.jsx)("option",{value:"staff",children:"Staff"})]}),(0,j.jsx)("button",{type:"button",onClick:I,disabled:G,className:"rounded-lg bg-[color:var(--accent-light)] px-4 py-2 text-sm font-semibold text-white hover:bg-[color:var(--accent)] disabled:opacity-60",children:"Send invite"})]}),w&&(0,j.jsx)("p",{className:"mt-3 text-sm text-[color:var(--text-2)]",children:w}),(0,j.jsx)("p",{className:"mt-3 text-sm text-[color:var(--text-2)]",children:"If a user already has an account but can’t sign in, ask them to use the ‘Forgot password’ link on the sign-in page to set a password."})]}),(0,j.jsx)("div",{className:"mt-6 overflow-hidden rounded-2xl border border-[color:var(--border)]",children:f?(0,j.jsx)("p",{className:"px-4 py-6 text-[color:var(--text-2)]",children:"Loading..."}):0===d.length?(0,j.jsx)("p",{className:"px-4 py-6 text-[color:var(--text-2)]",children:"No members found."}):(0,j.jsxs)("table",{className:"min-w-full divide-y divide-white/10 text-left text-sm",children:[(0,j.jsx)("thead",{className:"text-[color:var(--text-2)]",children:(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Name"}),(0,j.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Email"}),(0,j.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Role"}),(0,j.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Added"})]})}),(0,j.jsx)("tbody",{className:"divide-y divide-white/5 text-[color:var(--text-1)]",children:d.map(a=>{let b=a.user_id.slice(0,8);return(0,j.jsxs)("tr",{children:[(0,j.jsx)("td",{className:"px-4 py-3 text-white",children:a.full_name??"—"}),(0,j.jsx)("td",{className:"px-4 py-3 text-[color:var(--text-2)]",children:a.email??`ID: ${b}`}),(0,j.jsx)("td",{className:"px-4 py-3",children:(0,j.jsx)("span",{className:"rounded-full border border-[color:var(--border)] bg-[var(--surface-0)] px-2 py-1 text-xs uppercase tracking-wide text-[color:var(--muted)]",children:a.role})}),(0,j.jsx)("td",{className:"px-4 py-3 text-[color:var(--text-2)]",children:new Date(a.created_at).toLocaleDateString()})]},a.user_id)})})]})}),(0,j.jsx)("p",{className:"mt-4 text-sm text-[color:var(--text-2)]",children:"Names appear once users complete their profile."}),(0,j.jsxs)("div",{className:"mt-6 rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-6",children:[(0,j.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Pending invites"}),A?(0,j.jsx)("p",{className:"mt-3 text-sm text-[color:var(--text-2)]",children:"Loading invites…"}):0===y.length?(0,j.jsx)("p",{className:"mt-3 text-sm text-[color:var(--text-2)]",children:"No pending invites."}):(0,j.jsx)("ul",{className:"mt-3 space-y-2 text-sm text-[color:var(--text-2)]",children:y.map(a=>(0,j.jsxs)("li",{className:"flex flex-wrap items-center justify-between gap-2 rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2",children:[(0,j.jsx)("span",{children:a.email}),(0,j.jsx)("span",{className:"rounded-full border border-[color:var(--border)] px-2 py-1 text-xs uppercase tracking-wide text-[color:var(--muted)]",children:a.role}),(0,j.jsxs)("div",{className:"flex items-center gap-3",children:[(0,j.jsx)("span",{className:"text-xs text-[color:var(--text-2)]",children:new Date(a.created_at).toLocaleDateString()}),(0,j.jsx)("button",{type:"button",onClick:()=>J(a),disabled:G,className:"rounded-lg border border-[color:var(--border)] px-2 py-1 text-xs font-semibold uppercase tracking-wide text-[color:var(--muted)] hover:text-white disabled:opacity-60",children:"Resend"}),C[a.id]&&(0,j.jsx)("span",{className:"text-xs text-[color:var(--text-2)]",children:C[a.id]})]})]},a.id))})]})]})]})]})}var v=c(6104);let w=(0,g.M)(d,"default"),x=(0,g.M)(d,"getStaticProps"),y=(0,g.M)(d,"getStaticPaths"),z=(0,g.M)(d,"getServerSideProps"),A=(0,g.M)(d,"config"),B=(0,g.M)(d,"reportWebVitals"),C=(0,g.M)(d,"unstable_getStaticProps"),D=(0,g.M)(d,"unstable_getStaticPaths"),E=(0,g.M)(d,"unstable_getStaticParams"),F=(0,g.M)(d,"unstable_getServerProps"),G=(0,g.M)(d,"unstable_getServerSideProps"),H=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/myclient/members",pathname:"/myclient/members",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:i.default,Document:h.default},userland:d}),I=(0,v.U)({srcPage:"/myclient/members",config:A,userland:d,routeModule:H,getStaticPaths:y,getStaticProps:x,getServerSideProps:z})},7910:a=>{"use strict";a.exports=require("stream")},8732:a=>{"use strict";a.exports=require("react/jsx-runtime")},9021:a=>{"use strict";a.exports=require("fs")},9247:(a,b,c)=>{a.exports=c(6186)},9382:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>f});var d=c(8732),e=c(6030);function f(){return(0,d.jsxs)(e.Html,{lang:"en",children:[(0,d.jsx)(e.Head,{children:(0,d.jsx)("link",{rel:"icon",href:"/favicon.svg",type:"image/svg+xml"})}),(0,d.jsxs)("body",{children:[(0,d.jsx)(e.Main,{}),(0,d.jsx)(e.NextScript,{})]})]})}}};var b=require("../../webpack-runtime.js");b.C(a);var c=b.X(0,[978,708,30,791,627],()=>b(b.s=6924));module.exports=c})();