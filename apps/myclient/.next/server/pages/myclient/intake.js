(()=>{var a={};a.id=338,a.ids=[220,338,636],a.modules={361:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},2015:a=>{"use strict";a.exports=require("react")},2260:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>s});var e=c(8732),f=c(9247),g=c.n(f),h=c(953),i=c.n(h),j=c(8038),k=c(2015),l=c(6955),m=c(484),n=c(7438),o=c(5833),p=c(2889),q=c(3209),r=a([n]);n=(r.then?(await r)():r)[0];let t=["open","paused","closed"];function s(){let a=(0,j.useRouter)(),{state:b}=(0,l._)(),{plan:c,loading:d}=(0,p.b)(),[f,h]=(0,k.useState)(""),[r,s]=(0,k.useState)(""),[u,v]=(0,k.useState)(""),[w,x]=(0,k.useState)(""),[y,z]=(0,k.useState)("Divorce"),[A,B]=(0,k.useState)("open"),[C,D]=(0,k.useState)(""),[E,F]=(0,k.useState)(!1),[G,H]=(0,k.useState)(""),[I,J]=(0,k.useState)(""),[K,L]=(0,k.useState)(""),[M,N]=(0,k.useState)(""),[O,P]=(0,k.useState)(""),[Q,R]=(0,k.useState)(!1),[S,T]=(0,k.useState)(null),[U,V]=(0,k.useState)({}),[W,X]=(0,k.useState)(null),[Y,Z]=(0,k.useState)(!1),$=(0,o.Ue)(b.role),_=!!(b.authed&&b.firmId&&!$),aa=null===W?{ok:!0}:(0,q.Z8)({plan:c,currentCaseCount:W}),ab=!d&&null!==W&&!aa.ok,ac=async c=>{if(c.preventDefault(),T(null),V({}),!b.firmId)return void T("No firm linked yet.");if(!$)return void T("You don’t have permission to perform this action. Please contact your firm admin.");if(ab)return void T(`${aa.reason} Upgrade to Pro to add more cases.`);let d=n.O.safeParse({client_first_name:f,client_last_name:r,client_email:u,client_phone:w,title:C,matter_type:y,status:A,state:G,county:I,court_name:K,case_number:M,internal_notes:O});if(!d.success){let a={};d.error.errors.forEach(b=>{"client_first_name"===b.path[0]&&(a.firstName=b.message),"client_last_name"===b.path[0]&&(a.lastName=b.message)}),V(a),T(d.error.errors[0]?.message||"Please check the intake fields.");return}R(!0);try{let b=d.data,c=(0,n.l)(b),{data:e,error:f}=await m.N.auth.getSession();if(f||!e.session?.access_token)return void T(f?.message||"Please sign in to create a case.");let g=await fetch("/api/myclient/cases/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.session.access_token}`},body:JSON.stringify({client_first_name:b.client_first_name,client_last_name:b.client_last_name,client_email:b.client_email||null,client_phone:b.client_phone||null,title:c,matter_type:b.matter_type||"Divorce",status:b.status||"open",state:b.state||null,county:b.county||null,court_name:b.court_name||null,case_number:b.case_number||null,internal_notes:b.internal_notes||null})}),h=await g.json().catch(()=>({}));if(!g.ok||!h.ok){let a=h.error||"Unable to create case.";T((a=>{if(!a)return!1;let b=a.toLowerCase();return b.includes("permission")||b.includes("policy")||b.includes("not allowed")})(a)?"You don’t have permission to perform this action. Please contact your firm admin.":a);return}a.push(`/myclient/cases/${h.caseId}`)}catch(a){T(a instanceof Error?a.message:"Unable to create case.")}finally{R(!1)}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(g(),{children:(0,e.jsx)("title",{children:"MyClient | New Case Intake"})}),(0,e.jsxs)("div",{className:"mx-auto max-w-6xl rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-8 shadow-sm",children:[(0,e.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,e.jsx)(i(),{href:"/myclient/app",className:"text-sm text-[color:var(--muted)] hover:text-white transition",children:"← Back"}),(0,e.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"New Case Intake"})]}),(0,e.jsxs)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:["Firm ",b.firmId?b.firmId.slice(0,8):"No firm"," \xb7 Role ",b.role??"member"]}),b.loading&&(0,e.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Loading..."}),!b.loading&&!b.authed&&(0,e.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Please sign in."}),!b.loading&&b.authed&&!b.firmId&&(0,e.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"No firm linked yet."}),b.authed&&b.firmId&&(0,e.jsxs)("form",{onSubmit:ac,className:"mt-8 space-y-8",children:[_&&(0,e.jsx)("div",{className:"rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-sm text-[color:var(--muted)]",children:"You have read-only access. Please contact your firm admin to create a case."}),ab&&(0,e.jsxs)("div",{className:"rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-sm text-[color:var(--muted)]",children:[aa.reason," Upgrade to Pro to add more cases.",(0,e.jsx)(i(),{href:"/myclient/upgrade",className:"ml-2 text-white underline underline-offset-4",children:"Upgrade"})]}),S&&(0,e.jsx)("div",{className:"rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-3 text-sm text-red-200",children:S}),(0,e.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,e.jsxs)("section",{className:"space-y-6",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Client Information"}),(0,e.jsx)("p",{className:"mt-1 text-sm text-[color:var(--muted)]",children:"Who is this case for?"})]}),(0,e.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,e.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["First name *",(0,e.jsx)("input",{value:f,onChange:a=>h(a.target.value),disabled:_,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]",required:!0}),U.firstName&&(0,e.jsx)("span",{className:"mt-1 block text-xs text-red-300",children:U.firstName})]}),(0,e.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["Last name *",(0,e.jsx)("input",{value:r,onChange:a=>s(a.target.value),disabled:_,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]",required:!0}),U.lastName&&(0,e.jsx)("span",{className:"mt-1 block text-xs text-red-300",children:U.lastName})]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Contact"}),(0,e.jsxs)("div",{className:"mt-3 grid gap-4 sm:grid-cols-2",children:[(0,e.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["Email (optional)",(0,e.jsx)("input",{type:"email",value:u,onChange:a=>v(a.target.value),disabled:_,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,e.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["Phone (optional)",(0,e.jsx)("input",{type:"tel",value:w,onChange:a=>x(a.target.value),disabled:_,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]})]})]})]}),(0,e.jsxs)("section",{className:"space-y-6",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Matter Details"}),(0,e.jsx)("p",{className:"mt-1 text-sm text-[color:var(--muted)]",children:"Define the case type and tracking basics."})]}),(0,e.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["Matter type",(0,e.jsx)("input",{value:y,onChange:a=>z(a.target.value),disabled:_,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,e.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["Status",(0,e.jsx)("select",{value:A,onChange:a=>B(a.target.value),disabled:_,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:t.map(a=>(0,e.jsx)("option",{value:a,children:a},a))})]}),(0,e.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["Matter title (optional)",(0,e.jsx)("input",{value:C,onChange:a=>{var b;return b=a.target.value,void(D(b),F(b.trim().length>0))},disabled:_,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"}),(0,e.jsx)("span",{className:"mt-2 block text-xs text-[color:var(--muted-2)]",children:"Default title is generated from client + matter type."})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Jurisdiction"}),(0,e.jsxs)("div",{className:"mt-3 grid gap-4 sm:grid-cols-2",children:[(0,e.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["State (optional)",(0,e.jsx)("input",{value:G,onChange:a=>H(a.target.value),disabled:_,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,e.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["County (optional)",(0,e.jsx)("input",{value:I,onChange:a=>J(a.target.value),disabled:_,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,e.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["Court name (optional)",(0,e.jsx)("input",{value:K,onChange:a=>L(a.target.value),disabled:_,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,e.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["Case number (optional)",(0,e.jsx)("input",{value:M,onChange:a=>N(a.target.value),disabled:_,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]})]})]})]})]}),(0,e.jsxs)("section",{children:[(0,e.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Intake Summary"}),(0,e.jsx)("p",{className:"mt-1 text-sm text-[color:var(--muted)]",children:"Capture key details for your team."}),(0,e.jsx)("textarea",{value:O,onChange:a=>P(a.target.value),disabled:_,rows:5,className:"mt-3 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,e.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,e.jsx)("button",{type:"submit",disabled:Q||_||ab||Y,className:"rounded-lg bg-[color:var(--accent-light)] px-5 py-2.5 text-sm font-semibold text-white hover:bg-[color:var(--accent)] disabled:opacity-60",children:Q?"Creating…":"Create Case"}),(0,e.jsx)("p",{className:"text-xs text-[color:var(--muted-2)]",children:"Your data is secured and isolated to your firm."})]})]})]})]})}d()}catch(a){d(a)}})},2326:a=>{"use strict";a.exports=require("react-dom")},2889:(a,b,c)=>{"use strict";c.d(b,{b:()=>h});var d=c(2015),e=c(484),f=c(6955);let g="free";function h(){let{state:a}=(0,f._)(),[b,c]=(0,d.useState)({plan:g,loading:!0,error:null});return(0,d.useCallback)(async()=>{if(!a.authed||!a.firmId)return void c({plan:g,loading:!1,error:null});c(a=>({...a,loading:!0,error:null}));let{data:b,error:d}=await e.N.from("firms").select("plan").eq("id",a.firmId).single();if(d)return void c({plan:g,loading:!1,error:d.message});c({plan:b?.plan??g,loading:!1,error:null})},[a.authed,a.firmId]),b}},2971:a=>{"use strict";a.exports=import("zod")},3209:(a,b,c)=>{"use strict";c.d(b,{HK:()=>d,Z8:()=>f,nh:()=>h,wq:()=>g});let d={free:{maxCases:25,maxMembers:3,maxDocuments:200},pro:null,enterprise:null};function e(a){return null===d[a]}function f(a){return e(a.plan)?{ok:!0}:a.currentCaseCount>=d[a.plan].maxCases?{ok:!1,reason:`Case limit reached for Free plan (${d[a.plan].maxCases}).`}:{ok:!0}}function g(a){return e(a.plan)?{ok:!0}:a.currentMemberCount>=d[a.plan].maxMembers?{ok:!1,reason:`Member limit reached for Free plan (${d[a.plan].maxMembers}).`}:{ok:!0}}function h(a){return e(a.plan)?{ok:!0}:a.currentDocumentCount>=d[a.plan].maxDocuments?{ok:!1,reason:`Document limit reached for Free plan (${d[a.plan].maxDocuments}).`}:{ok:!0}}},3873:a=>{"use strict";a.exports=require("path")},3939:a=>{"use strict";a.exports=require("@supabase/supabase-js")},3948:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>q,default:()=>m,getServerSideProps:()=>p,getStaticPaths:()=>o,getStaticProps:()=>n,handler:()=>y,reportWebVitals:()=>r,routeModule:()=>x,unstable_getServerProps:()=>v,unstable_getServerSideProps:()=>w,unstable_getStaticParams:()=>u,unstable_getStaticPaths:()=>t,unstable_getStaticProps:()=>s});var e=c(2636),f=c(4850),g=c(3410),h=c(9382),i=c(2627),j=c(2260),k=c(6104),l=a([j]);j=(l.then?(await l)():l)[0];let m=(0,g.M)(j,"default"),n=(0,g.M)(j,"getStaticProps"),o=(0,g.M)(j,"getStaticPaths"),p=(0,g.M)(j,"getServerSideProps"),q=(0,g.M)(j,"config"),r=(0,g.M)(j,"reportWebVitals"),s=(0,g.M)(j,"unstable_getStaticProps"),t=(0,g.M)(j,"unstable_getStaticPaths"),u=(0,g.M)(j,"unstable_getStaticParams"),v=(0,g.M)(j,"unstable_getServerProps"),w=(0,g.M)(j,"unstable_getServerSideProps"),x=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/myclient/intake",pathname:"/myclient/intake",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:i.default,Document:h.default},userland:j}),y=(0,k.U)({srcPage:"/myclient/intake",config:q,userland:j,routeModule:x,getStaticPaths:o,getStaticProps:n,getServerSideProps:p});d()}catch(a){d(a)}})},4075:a=>{"use strict";a.exports=require("zlib")},5833:(a,b,c)=>{"use strict";function d(a){if("string"!=typeof a)return null;let b=a.toLowerCase();return"admin"===b||"attorney"===b||"staff"===b?b:null}function e(a){let b=d(a);return"admin"===b||"attorney"===b}function f(a){let b=d(a);return"admin"===b||"attorney"===b}function g(a){let b=d(a);return"admin"===b||"attorney"===b}function h(a){return"admin"===d(a)}c.d(b,{TX:()=>f,Ue:()=>e,gL:()=>g,jR:()=>h})},6060:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},7438:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{O:()=>h,l:()=>g});var e=c(2971),f=a([e]);let h=(e=(f.then?(await f)():f)[0]).z.object({client_first_name:e.z.string().trim().min(1,"Client first name is required."),client_last_name:e.z.string().trim().min(1,"Client last name is required."),client_email:e.z.string().trim().email("Enter a valid email.").optional().or(e.z.literal("")),client_phone:e.z.string().trim().optional().or(e.z.literal("")),title:e.z.string().trim().optional().or(e.z.literal("")),matter_type:e.z.string().trim().optional().default("Divorce"),status:e.z.string().trim().optional().default("open"),state:e.z.string().trim().optional().or(e.z.literal("")),county:e.z.string().trim().optional().or(e.z.literal("")),court_name:e.z.string().trim().optional().or(e.z.literal("")),case_number:e.z.string().trim().optional().or(e.z.literal("")),internal_notes:e.z.string().trim().optional().or(e.z.literal(""))});function g(a){let b=(a.title??"").trim();if(b)return b;let c=(a.matter_type??"").trim()||"Matter";return`${a.client_last_name}, ${a.client_first_name} — ${c}`}d()}catch(a){d(a)}})},7910:a=>{"use strict";a.exports=require("stream")},8732:a=>{"use strict";a.exports=require("react/jsx-runtime")},9021:a=>{"use strict";a.exports=require("fs")},9247:(a,b,c)=>{a.exports=c(6186)},9382:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>f});var d=c(8732),e=c(6030);function f(){return(0,d.jsxs)(e.Html,{lang:"en",children:[(0,d.jsx)(e.Head,{children:(0,d.jsx)("link",{rel:"icon",href:"/favicon.svg",type:"image/svg+xml"})}),(0,d.jsxs)("body",{children:[(0,d.jsx)(e.Main,{}),(0,d.jsx)(e.NextScript,{})]})]})}}};var b=require("../../webpack-runtime.js");b.C(a);var c=b.X(0,[978,708,30,791,627],()=>b(b.s=3948));module.exports=c})();