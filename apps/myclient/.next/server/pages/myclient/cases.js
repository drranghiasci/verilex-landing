(()=>{var a={};a.id=973,a.ids=[220,636,973],a.modules={361:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},2015:a=>{"use strict";a.exports=require("react")},2326:a=>{"use strict";a.exports=require("react-dom")},3873:a=>{"use strict";a.exports=require("path")},3939:a=>{"use strict";a.exports=require("@supabase/supabase-js")},4075:a=>{"use strict";a.exports=require("zlib")},5833:(a,b,c)=>{"use strict";function d(a){if("string"!=typeof a)return null;let b=a.toLowerCase();return"admin"===b||"attorney"===b||"staff"===b?b:null}function e(a){let b=d(a);return"admin"===b||"attorney"===b}function f(a){let b=d(a);return"admin"===b||"attorney"===b}function g(a){let b=d(a);return"admin"===b||"attorney"===b}function h(a){return"admin"===d(a)}c.d(b,{TX:()=>f,Ue:()=>e,gL:()=>g,jR:()=>h})},6060:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},7910:a=>{"use strict";a.exports=require("stream")},8245:(a,b,c)=>{"use strict";c.r(b),c.d(b,{config:()=>E,default:()=>A,getServerSideProps:()=>D,getStaticPaths:()=>C,getStaticProps:()=>B,handler:()=>M,reportWebVitals:()=>F,routeModule:()=>L,unstable_getServerProps:()=>J,unstable_getServerSideProps:()=>K,unstable_getStaticParams:()=>I,unstable_getStaticPaths:()=>H,unstable_getStaticProps:()=>G});var d={};c.r(d),c.d(d,{default:()=>y});var e=c(2636),f=c(4850),g=c(3410),h=c(9382),i=c(2627),j=c(8732),k=c(9247),l=c.n(k),m=c(953),n=c.n(m),o=c(2015),p=c(6955),q=c(484),r=c(5833),s=c(7574);let t=["open","paused","closed"];function u({open:a,onClose:b,caseRow:c,role:d,onSaved:e}){let[f,g]=(0,o.useState)(""),[h,i]=(0,o.useState)(""),[k,l]=(0,o.useState)(""),[m,n]=(0,o.useState)(""),[p,u]=(0,o.useState)(""),[v,w]=(0,o.useState)(""),[x,y]=(0,o.useState)(""),[z,A]=(0,o.useState)("open"),[B,C]=(0,o.useState)(!1),[D,E]=(0,o.useState)(null),[F,G]=(0,o.useState)(null),H=(0,r.Ue)(d);if(!a||!c)return null;let I=async()=>{if(E(null),G(null),!H)return void E("You don’t have permission to perform this action. Please contact your firm admin.");if(!f.trim()||!h.trim()||!k.trim())return void E("Title, first name, and last name are required.");C(!0);try{let{data:a,error:d}=await q.N.auth.getSession();if(d||!a.session?.access_token)return void E(d?.message||"Please sign in.");let g=await fetch("/api/myclient/cases/update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.session.access_token}`},body:JSON.stringify({id:c.id,title:f.trim(),client_first_name:h.trim(),client_last_name:k.trim(),client_email:m.trim()||null,client_phone:p.trim()||null,state:v.trim()||null,county:x.trim()||null,status:z})}),i=await g.json().catch(()=>({}));if(!g.ok||!i.ok){let a=i.error||"Unable to update case.",b=String(a).toLowerCase();E(b.includes("permission")||b.includes("policy")||b.includes("not allowed")?"You don’t have permission to perform this action. Please contact your firm admin.":a);return}let j={...c,title:f.trim(),client_first_name:h.trim(),client_last_name:k.trim(),client_email:m.trim()||null,client_phone:p.trim()||null,state:v.trim()||null,county:x.trim()||null,status:z};e(j),G("Saved"),b()}catch(a){E(a instanceof Error?a.message:"Unable to update case.")}finally{C(!1)}};return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("button",{type:"button","aria-label":"Close edit case",onClick:b,className:"fixed inset-0 z-40 bg-black/40 backdrop-blur-[1px]"}),(0,j.jsx)("aside",{className:"fixed right-0 top-16 z-50 h-[calc(100vh-64px)] w-full max-w-[420px] border-l border-[color:var(--border)] bg-[var(--surface-0)] shadow-2xl",children:(0,j.jsxs)("div",{className:"flex h-full flex-col",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between border-b border-[color:var(--border)] px-5 py-4",children:[(0,j.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Edit Case"}),(0,j.jsx)("button",{type:"button","aria-label":"Close edit",onClick:b,className:"rounded-lg border border-[color:var(--border)] p-1.5 text-[color:var(--muted)] hover:text-white",children:(0,j.jsx)(s.X,{className:"h-4 w-4"})})]}),(0,j.jsx)("div",{className:"flex-1 overflow-y-auto px-5 py-6",children:(0,j.jsxs)("div",{className:"space-y-4 text-sm",children:[D&&(0,j.jsx)("div",{className:"rounded-lg border border-red-400/30 bg-red-500/10 px-3 py-2 text-red-200",children:D}),F&&(0,j.jsx)("div",{className:"rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white",children:F}),(0,j.jsxs)("label",{className:"block text-[color:var(--muted)]",children:["Matter title",(0,j.jsx)("input",{value:f,onChange:a=>g(a.target.value),className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,j.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,j.jsxs)("label",{className:"block text-[color:var(--muted)]",children:["First name",(0,j.jsx)("input",{value:h,onChange:a=>i(a.target.value),className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,j.jsxs)("label",{className:"block text-[color:var(--muted)]",children:["Last name",(0,j.jsx)("input",{value:k,onChange:a=>l(a.target.value),className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]})]}),(0,j.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,j.jsxs)("label",{className:"block text-[color:var(--muted)]",children:["Email",(0,j.jsx)("input",{type:"email",value:m,onChange:a=>n(a.target.value),className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,j.jsxs)("label",{className:"block text-[color:var(--muted)]",children:["Phone",(0,j.jsx)("input",{value:p,onChange:a=>u(a.target.value),className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]})]}),(0,j.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,j.jsxs)("label",{className:"block text-[color:var(--muted)]",children:["State",(0,j.jsx)("input",{value:v,onChange:a=>w(a.target.value),className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,j.jsxs)("label",{className:"block text-[color:var(--muted)]",children:["County",(0,j.jsx)("input",{value:x,onChange:a=>y(a.target.value),className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]})]}),(0,j.jsxs)("label",{className:"block text-[color:var(--muted)]",children:["Status",(0,j.jsx)("select",{value:z,onChange:a=>A(a.target.value),className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:t.map(a=>(0,j.jsx)("option",{value:a,children:a},a))})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("p",{className:"text-[color:var(--muted)]",children:"Notes preview"}),(0,j.jsx)("textarea",{value:c.internal_notes??"",readOnly:!0,rows:4,className:"mt-2 w-full resize-none rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-[color:var(--muted)]"})]})]})}),(0,j.jsx)("div",{className:"border-t border-[color:var(--border)] px-5 py-4",children:(0,j.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,j.jsx)("button",{type:"button",onClick:b,className:"rounded-lg border border-[color:var(--border)] px-4 py-2 text-sm font-semibold text-[color:var(--muted)] hover:text-white",children:"Cancel"}),(0,j.jsx)("button",{type:"button",onClick:I,disabled:B||!H,className:"rounded-lg bg-[color:var(--accent-light)] px-5 py-2 text-sm font-semibold text-white hover:bg-[color:var(--accent)] disabled:opacity-60",children:B?"Saving…":"Save changes"})]})})]})})]})}let v=[{value:"all",label:"All"},{value:"open",label:"Open"},{value:"paused",label:"Paused"},{value:"closed",label:"Closed"}],w=[{value:"last_activity",label:"Last activity"},{value:"newest",label:"Newest"},{value:"client_last",label:"Client last name"}],x={open:"border-emerald-400/40 text-emerald-200",paused:"border-amber-400/40 text-amber-200",closed:"border-slate-400/40 text-slate-200"};function y(){let{state:a}=(0,p._)(),[b,c]=(0,o.useState)([]),[d,e]=(0,o.useState)(!1),[f,g]=(0,o.useState)(null),[h,i]=(0,o.useState)(""),[k,m]=(0,o.useState)("all"),[q,s]=(0,o.useState)("all"),[t,y]=(0,o.useState)("all"),[z,A]=(0,o.useState)("last_activity"),[B,C]=(0,o.useState)(!1),[D,E]=(0,o.useState)(null),F=function(a,b=300){let[c,d]=(0,o.useState)(a);return c}(h),G=(0,r.Ue)(a.role),H=a.role??null,I=(0,o.useMemo)(()=>a.firmId?a.firmId.slice(0,8):"No firm",[a.firmId]),J=(0,o.useMemo)(()=>Array.from(new Set(b.map(a=>a.state).filter(a=>!!a))).sort(),[b]),K=(0,o.useMemo)(()=>Array.from(new Set(b.filter(a=>"all"===q||a.state===q).map(a=>a.county).filter(a=>!!a))).sort(),[b,q]),L=(0,o.useMemo)(()=>{let a=F.trim().toLowerCase(),c=[...b.filter(b=>("all"===k||(b.status??"").toLowerCase()===k)&&("all"===q||b.state===q)&&("all"===t||b.county===t)&&(!a||!![b.title,b.client_first_name,b.client_last_name,b.case_number].filter(Boolean).join(" ").toLowerCase().includes(a))&&!0)];return c.sort((a,b)=>{if("newest"===z){let c=a.created_at?new Date(a.created_at).getTime():0;return(b.created_at?new Date(b.created_at).getTime():0)-c}if("client_last"===z){let c=a.client_last_name||a.title||"",d=b.client_last_name||b.title||"";return c.localeCompare(d)}let c=a.last_activity_at||a.created_at,d=b.last_activity_at||b.created_at,e=c?new Date(c).getTime():0;return(d?new Date(d).getTime():0)-e}),c},[b,t,F,z,q,k]);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(l(),{children:(0,j.jsx)("title",{children:"MyClient | Cases"})}),(0,j.jsxs)("div",{className:"mx-auto max-w-6xl rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-8 shadow-sm",children:[(0,j.jsx)("div",{className:"sticky top-6 z-10 -mx-8 mb-6 border-b border-[color:var(--border)] bg-[var(--surface-1)] px-8 pb-6 pt-2",children:(0,j.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-end lg:justify-between",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)(n(),{href:"/myclient/app",className:"text-sm text-[color:var(--muted)] hover:text-white transition",children:"← Back"}),(0,j.jsx)("h1",{className:"mt-3 text-3xl font-semibold text-white",children:"Active Cases"}),(0,j.jsxs)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:["Firm ",I]})]}),(0,j.jsxs)("div",{className:"flex w-full flex-col gap-3 lg:w-auto lg:min-w-[360px]",children:[(0,j.jsx)("input",{value:h,onChange:a=>i(a.target.value),placeholder:"Search by client, title, or case number",className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-2 text-sm text-[color:var(--text)] placeholder:text-[color:var(--muted-2)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"}),(0,j.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,j.jsx)("select",{"aria-label":"Filter by status",value:k,onChange:a=>m(a.target.value),className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:v.map(a=>(0,j.jsxs)("option",{value:a.value,children:["Status: ",a.label]},a.value))}),(0,j.jsx)("select",{"aria-label":"Sort cases by",value:z,onChange:a=>A(a.target.value),className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:w.map(a=>(0,j.jsxs)("option",{value:a.value,children:["Sort: ",a.label]},a.value))})]}),(0,j.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,j.jsxs)("select",{"aria-label":"Filter by state",value:q,onChange:a=>{s(a.target.value),y("all")},className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:[(0,j.jsx)("option",{value:"all",children:"State: All"}),J.map(a=>(0,j.jsx)("option",{value:a,children:a},a))]}),(0,j.jsxs)("select",{title:"Filter by county",value:t,onChange:a=>y(a.target.value),className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:[(0,j.jsx)("option",{value:"all",children:"County: All"}),K.map(a=>(0,j.jsx)("option",{value:a,children:a},a))]})]}),(0,j.jsx)("button",{type:"button",onClick:()=>{i(""),m("all"),s("all"),y("all"),A("last_activity")},disabled:!h.trim()&&"all"===k&&"all"===q&&"all"===t&&"last_activity"===z,className:"w-full rounded-lg border border-[color:var(--border)] px-3 py-2 text-xs font-semibold uppercase tracking-wide text-[color:var(--muted)] hover:text-white disabled:cursor-not-allowed disabled:opacity-50",children:"Clear filters"})]})]})}),a.loading&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Loading..."}),!a.loading&&!a.authed&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Please sign in."}),!a.loading&&a.authed&&!a.firmId&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"No firm linked yet."}),f&&(0,j.jsx)("div",{className:"mt-6 rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:f}),a.authed&&a.firmId&&(0,j.jsx)("div",{className:"space-y-4",children:d?(0,j.jsx)("p",{className:"text-[color:var(--muted)]",children:"Loading..."}):0===L.length?(0,j.jsxs)("div",{className:"rounded-2xl border border-[color:var(--border)] bg-[var(--surface-0)] p-8 text-center",children:[(0,j.jsx)("h2",{className:"text-xl font-semibold text-white",children:"No cases match your filters."}),(0,j.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"Start a new case intake to populate your dashboard."}),(0,j.jsx)(n(),{href:"/myclient/intake",className:"mt-4 inline-flex items-center justify-center rounded-lg bg-[color:var(--accent-light)] px-4 py-2 text-sm font-semibold text-white hover:bg-[color:var(--accent)]",children:"New Case Intake"})]}):L.map(a=>{let{displayName:b,subtitle:c}=function(a){let b=a.client_last_name||a.client_first_name?`${a.client_last_name??""}${a.client_first_name?`, ${a.client_first_name}`:""}`.trim():a.title||"Untitled case",c=[a.county,a.state].filter(Boolean).join(", ");return{displayName:b,subtitle:[a.matter_type,c,a.case_number?`Case #${a.case_number}`:null].filter(Boolean).join(" • ")}}(a),d=x[(a.status??"").toLowerCase()]??"border-white/15 text-[color:var(--muted)]",e=a.status??"Unknown";return(0,j.jsx)("div",{className:"rounded-2xl border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-4 transition hover:bg-white/5",children:(0,j.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,j.jsx)(n(),{href:`/myclient/cases/${a.id}`,className:"flex-1",children:(0,j.jsxs)("div",{children:[(0,j.jsx)("p",{className:"text-base font-semibold text-white",children:b}),(0,j.jsx)("p",{className:"mt-1 text-xs text-[color:var(--muted-2)]",children:c||"No details yet"})]})}),(0,j.jsxs)("div",{className:"flex items-center gap-3",children:[(0,j.jsx)("span",{className:`rounded-full border px-2 py-1 text-xs uppercase tracking-wide ${d}`,children:e}),(0,j.jsx)("span",{className:"text-xs text-[color:var(--muted-2)]",children:function(a){if(!a)return"—";let b=new Date,c=new Date(a),d=Math.floor((b.getTime()-c.getTime())/6e4);if(d<1)return"Just now";if(d<60)return`${d}m ago`;let e=Math.floor(d/60);if(e<24)return`${e}h ago`;let f=Math.floor(e/24);return f<30?`${f}d ago`:c.toLocaleDateString()}(a.last_activity_at||a.created_at)}),G?(0,j.jsx)("button",{type:"button",onClick:()=>{E(a),C(!0)},className:"rounded-lg border border-[color:var(--border)] px-3 py-1.5 text-xs font-semibold uppercase tracking-wide text-[color:var(--muted)] hover:text-white",children:"Edit"}):(0,j.jsx)("span",{className:"text-xs text-[color:var(--muted-2)]",children:"View only"})]})]})},a.id)})}),(0,j.jsx)(u,{open:B,onClose:()=>C(!1),caseRow:D,role:H,onSaved:a=>{c(b=>b.map(b=>b.id===a.id?{...b,...a}:b))}})]})]})}var z=c(6104);let A=(0,g.M)(d,"default"),B=(0,g.M)(d,"getStaticProps"),C=(0,g.M)(d,"getStaticPaths"),D=(0,g.M)(d,"getServerSideProps"),E=(0,g.M)(d,"config"),F=(0,g.M)(d,"reportWebVitals"),G=(0,g.M)(d,"unstable_getStaticProps"),H=(0,g.M)(d,"unstable_getStaticPaths"),I=(0,g.M)(d,"unstable_getStaticParams"),J=(0,g.M)(d,"unstable_getServerProps"),K=(0,g.M)(d,"unstable_getServerSideProps"),L=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/myclient/cases",pathname:"/myclient/cases",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:i.default,Document:h.default},userland:d}),M=(0,z.U)({srcPage:"/myclient/cases",config:E,userland:d,routeModule:L,getStaticPaths:C,getStaticProps:B,getServerSideProps:D})},8732:a=>{"use strict";a.exports=require("react/jsx-runtime")},9021:a=>{"use strict";a.exports=require("fs")},9247:(a,b,c)=>{a.exports=c(6186)},9382:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>f});var d=c(8732),e=c(6030);function f(){return(0,d.jsxs)(e.Html,{lang:"en",children:[(0,d.jsx)(e.Head,{children:(0,d.jsx)("link",{rel:"icon",href:"/favicon.svg",type:"image/svg+xml"})}),(0,d.jsxs)("body",{children:[(0,d.jsx)(e.Main,{}),(0,d.jsx)(e.NextScript,{})]})]})}}};var b=require("../../webpack-runtime.js");b.C(a);var c=b.X(0,[978,708,30,791,627],()=>b(b.s=8245));module.exports=c})();