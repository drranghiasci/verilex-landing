(()=>{var a={};a.id=177,a.ids=[177,220,636],a.modules={361:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},2015:a=>{"use strict";a.exports=require("react")},2326:a=>{"use strict";a.exports=require("react-dom")},2889:(a,b,c)=>{"use strict";c.d(b,{b:()=>h});var d=c(2015),e=c(484),f=c(6955);let g="free";function h(){let{state:a}=(0,f._)(),[b,c]=(0,d.useState)({plan:g,loading:!0,error:null});return(0,d.useCallback)(async()=>{if(!a.authed||!a.firmId)return void c({plan:g,loading:!1,error:null});c(a=>({...a,loading:!0,error:null}));let{data:b,error:d}=await e.N.from("firms").select("plan").eq("id",a.firmId).single();if(d)return void c({plan:g,loading:!1,error:d.message});c({plan:b?.plan??g,loading:!1,error:null})},[a.authed,a.firmId]),b}},3209:(a,b,c)=>{"use strict";c.d(b,{HK:()=>d,Z8:()=>f,nh:()=>h,wq:()=>g});let d={free:{maxCases:25,maxMembers:3,maxDocuments:200},pro:null,enterprise:null};function e(a){return null===d[a]}function f(a){return e(a.plan)?{ok:!0}:a.currentCaseCount>=d[a.plan].maxCases?{ok:!1,reason:`Case limit reached for Free plan (${d[a.plan].maxCases}).`}:{ok:!0}}function g(a){return e(a.plan)?{ok:!0}:a.currentMemberCount>=d[a.plan].maxMembers?{ok:!1,reason:`Member limit reached for Free plan (${d[a.plan].maxMembers}).`}:{ok:!0}}function h(a){return e(a.plan)?{ok:!0}:a.currentDocumentCount>=d[a.plan].maxDocuments?{ok:!1,reason:`Document limit reached for Free plan (${d[a.plan].maxDocuments}).`}:{ok:!0}}},3865:(a,b,c)=>{"use strict";c.r(b),c.d(b,{config:()=>D,default:()=>z,getServerSideProps:()=>C,getStaticPaths:()=>B,getStaticProps:()=>A,handler:()=>L,reportWebVitals:()=>E,routeModule:()=>K,unstable_getServerProps:()=>I,unstable_getServerSideProps:()=>J,unstable_getStaticParams:()=>H,unstable_getStaticPaths:()=>G,unstable_getStaticProps:()=>F});var d={};c.r(d),c.d(d,{default:()=>x});var e=c(2636),f=c(4850),g=c(3410),h=c(9382),i=c(2627),j=c(8732),k=c(9247),l=c.n(k),m=c(953),n=c.n(m),o=c(8038),p=c(2015),q=c(484),r=c(6955),s=c(5833),t=c(8688),u=c(2889),v=c(3209);let w={open:"border-emerald-400/40 text-emerald-200",paused:"border-amber-400/40 text-amber-200",closed:"border-slate-400/40 text-slate-200"};function x(){let a=(0,o.useRouter)(),{state:b}=(0,r._)(),{plan:c,loading:d}=(0,u.b)(),[e,f]=(0,p.useState)(null),[g,h]=(0,p.useState)(!0),[i,k]=(0,p.useState)(null),[m,x]=(0,p.useState)([]),[y,z]=(0,p.useState)(!1),[A,B]=(0,p.useState)(null),[C,D]=(0,p.useState)(null),[E,F]=(0,p.useState)(null),[G,H]=(0,p.useState)(null),[I,J]=(0,p.useState)(""),[K,L]=(0,p.useState)("other"),[M,N]=(0,p.useState)(""),[O,P]=(0,p.useState)([]),[Q,R]=(0,p.useState)(!1),[S,T]=(0,p.useState)(null),[U,V]=(0,p.useState)(""),[W,X]=(0,p.useState)(""),[Y,Z]=(0,p.useState)(null),[$,_]=(0,p.useState)(!1),[aa,ab]=(0,p.useState)(null),[ac,ad]=(0,p.useState)(null),[ae,af]=(0,p.useState)(null),[ag,ah]=(0,p.useState)(!1),[ai,aj]=(0,p.useState)(null),[ak,al]=(0,p.useState)("overview"),[am,an]=(0,p.useState)(""),[ao,ap]=(0,p.useState)(null);(0,p.useRef)(!1);let[aq,ar]=(0,p.useState)([]),[as,at]=(0,p.useState)(!1),[au,av]=(0,p.useState)(null),aw=(0,s.Ue)(b.role),ax=(0,s.TX)(b.role),ay=(0,s.gL)(b.role),az=null===ae?{ok:!0}:(0,v.nh)({plan:c,currentDocumentCount:ae}),aA=!d&&null!==ae&&!az.ok,aB=a=>{if(!a)return!1;let b=a.toLowerCase();return b.includes("permission")||b.includes("policy")||b.includes("not allowed")},aC=(0,p.useMemo)(()=>"string"==typeof a.query.id?a.query.id:null,[a.query.id]),aD=(0,p.useCallback)(async()=>{if(!b.authed||!b.firmId)return;ah(!0);let{count:a,error:c}=await q.N.from("case_documents").select("id",{count:"exact",head:!0}).eq("firm_id",b.firmId).is("deleted_at",null);c?af(null):af(a??0),ah(!1)},[b.authed,b.firmId]),aE=(0,p.useCallback)(async()=>{if(!b.authed||!b.firmId||!aC)return;z(!0),B(null);let{data:a,error:c}=await q.N.from("case_documents").select("id, filename, display_name, doc_type, tags, storage_path, created_at").eq("case_id",aC).eq("firm_id",b.firmId).not("storage_path","is",null).is("deleted_at",null).order("created_at",{ascending:!1});c?(B(c.message),x([])):x((a??[]).map(a=>({...a,display_name:a.display_name??null,doc_type:a.doc_type??"other",tags:a.tags??[]}))),z(!1)},[aC,b.authed,b.firmId]);(0,p.useCallback)(async()=>{if(!b.authed||!b.firmId||!aC)return;at(!0),av(null);let{data:a,error:c}=await q.N.from("case_activity").select("id, event_type, message, created_at").eq("case_id",aC).order("created_at",{ascending:!1}).limit(50);c?(av(c.message),ar([])):ar(a??[]),at(!1)},[aC,b.authed,b.firmId]),(0,p.useCallback)(async()=>{if(!b.authed||!b.firmId||!aC)return;R(!0),T(null);let{data:a,error:c}=await q.N.from("case_tasks").select("id, title, status, due_date, completed_at, created_at").eq("case_id",aC).eq("firm_id",b.firmId).order("status",{ascending:!0}).order("due_date",{ascending:!0,nullsFirst:!1}).order("created_at",{ascending:!1});c?(T(c.message),P([])):P(a??[]),R(!1)},[aC,b.authed,b.firmId]);let aF=async()=>{if(Z(null),!U.trim())return void Z("Task title is required.");if(!e||!b.firmId)return;if(!aw)return void Z("You don’t have permission to perform this action. Please contact your firm admin.");let{data:a}=await q.N.auth.getSession(),c=a.session?.user?.id??null,{data:d,error:f}=await q.N.from("case_tasks").insert({firm_id:b.firmId,case_id:e.id,title:U.trim(),due_date:W||null,created_by:c}).select("id, title, status, due_date, completed_at, created_at").single();if(f||!d)return void Z(aB(f?.message)?"You don’t have permission to perform this action. Please contact your firm admin.":f?.message||"Unable to add task.");P(a=>[d,...a]),V(""),X(""),await (0,t.M)(q.N,{firm_id:b.firmId,case_id:e.id,actor_user_id:c,event_type:"task_created",message:`Task created: ${d.title}`,metadata:{due_date:d.due_date}})},aG=async(a,c)=>{if(Z(null),!e||!b.firmId)return;if(!aw)return void Z("You don’t have permission to perform this action. Please contact your firm admin.");let d="done"===c?{status:"done",completed_at:new Date().toISOString()}:{status:"open",completed_at:null},{error:f}=await q.N.from("case_tasks").update(d).eq("id",a.id);if(f)return void Z(aB(f.message)?"You don’t have permission to perform this action. Please contact your firm admin.":f.message);P(b=>b.map(b=>b.id===a.id?{...b,...d}:b)),await (0,t.M)(q.N,{firm_id:b.firmId,case_id:e.id,actor_user_id:b.userId,event_type:"task_completed",message:"done"===c?`Task completed: ${a.title}`:`Task reopened: ${a.title}`,metadata:{}})},aH=async()=>{if(!aC||!ac)return void ab("Please choose a file to upload.");if(!b.firmId)return void ab("No firm linked yet.");if(!ax)return void ab("You don’t have permission to perform this action. Please contact your firm admin.");if(aA)return void ab(`${az.reason} Upgrade to Pro to upload more documents.`);_(!0),ab(null);try{let{data:a}=await q.N.auth.getSession(),c=a.session?.user?.id??null,{data:d,error:e}=await q.N.from("case_documents").insert({firm_id:b.firmId,case_id:aC,filename:ac.name,display_name:ac.name,doc_type:"other",tags:[],storage_path:null}).select("id").single();if(e||!d?.id)return void ab(aB(e?.message)?"You don’t have permission to perform this action. Please contact your firm admin.":e?.message||"Unable to create upload record.");let f=function(a){let b=a.replace(/[/\\]/g,"").trim().replace(/[^a-zA-Z0-9._-]/g,"_");return b.length>0?b:"document"}(ac.name),g=`${b.firmId}/cases/${aC}/${d.id}/${f}`,{error:h}=await q.N.storage.from("case-documents").upload(g,ac,{upsert:!1,contentType:ac.type||"application/octet-stream"});if(h){await q.N.from("case_documents").update({deleted_at:new Date().toISOString()}).eq("id",d.id),ab(h.message||"Unable to upload document.");return}let{error:i}=await q.N.from("case_documents").update({storage_path:g,size_bytes:ac.size,mime_type:ac.type||null}).eq("id",d.id);if(i){await q.N.from("case_documents").update({deleted_at:new Date().toISOString()}).eq("id",d.id),ab(i.message||"Unable to finalize upload.");return}try{await q.N.from("case_activity").insert({firm_id:b.firmId,case_id:aC,actor_user_id:c,event_type:"document_uploaded",message:`Document uploaded: ${ac.name}`,metadata:{file_name:ac.name}})}catch{}ad(null),await aE(),await aD()}catch(a){ab(a instanceof Error?a.message:"Unable to upload document.")}finally{_(!1)}},aI=async a=>{aj(a),B(null);try{let b=m.find(b=>b.id===a);if(!b?.storage_path)return void B("Document is missing a storage path.");let{data:c,error:d}=await q.N.storage.from("case-documents").createSignedUrl(b.storage_path,60);if(d||!c?.signedUrl)return void B(d?.message||"Unable to generate download link.");window.open(c.signedUrl,"_blank","noopener,noreferrer")}catch(a){B(a instanceof Error?a.message:"Unable to download document.")}finally{aj(null)}},aJ=async a=>{if(D(null),F(null),!ax)return void F("You don’t have permission to perform this action. Please contact your firm admin.");let c=M.split(",").map(a=>a.trim()).filter(a=>a.length>0),d=m.find(b=>b.id===a),{error:e}=await q.N.from("case_documents").update({display_name:I.trim()||null,doc_type:K,tags:c}).eq("id",a);if(e)return void F(aB(e.message)?"You don’t have permission to perform this action. Please contact your firm admin.":e.message);x(b=>b.map(b=>b.id===a?{...b,display_name:I.trim()||null,doc_type:K,tags:c}:b)),d&&b.firmId&&((d.display_name||d.filename)!==I.trim()&&await (0,t.M)(q.N,{firm_id:b.firmId,case_id:aC,actor_user_id:b.userId,event_type:"document_renamed",message:`Document renamed: ${d.display_name||d.filename} → ${I.trim()}`,metadata:{document_id:a}}),(d.doc_type!==K||d.tags.join(",")!==c.join(","))&&await (0,t.M)(q.N,{firm_id:b.firmId,case_id:aC,actor_user_id:b.userId,event_type:"document_updated",message:`Document updated: ${I.trim()||d.filename}`,metadata:{document_id:a}})),D("Saved"),H(null)},aK=async a=>{if(D(null),F(null),!ay)return void F("You don’t have permission to perform this action. Please contact your firm admin.");if(!window.confirm("Delete this document? This cannot be undone."))return;let{data:b,error:c}=await q.N.auth.getSession();if(c||!b.session?.access_token)return void F(c?.message||"Please sign in.");let d=await fetch("/api/myclient/documents/delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.session.access_token}`},body:JSON.stringify({documentId:a})}),e=await d.json().catch(()=>({}));if(!d.ok||!e.ok)return void F(aB(e.error)?"You don’t have permission to perform this action. Please contact your firm admin.":e.error||"Unable to delete document.");x(b=>b.filter(b=>b.id!==a)),D("Deleted"),await aD()};return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(l(),{children:(0,j.jsx)("title",{children:"MyClient | Case Detail"})}),(0,j.jsxs)("div",{className:"mx-auto max-w-6xl rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-8 shadow-sm",children:[(0,j.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,j.jsx)(n(),{href:"/myclient/cases",className:"text-sm text-[color:var(--muted)] hover:text-white transition",children:"← Back to Active Cases"}),(0,j.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,j.jsx)("h1",{className:"text-2xl font-semibold text-white",children:"Case Detail"}),e&&(0,j.jsx)("span",{className:`rounded-full border px-3 py-1 text-xs uppercase tracking-wide ${w[e.status.toLowerCase()]??"border-white/15 text-[color:var(--muted)]"}`,children:e.status})]})]}),b.loading&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Loading..."}),!b.loading&&!b.authed&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Please sign in."}),!b.loading&&b.authed&&!b.firmId&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"No firm linked yet."}),g&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Loading..."}),!g&&b.authed&&b.firmId&&!e&&!i&&(0,j.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Case not found."}),e&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{className:"mt-6 rounded-2xl border border-[color:var(--border)] bg-[var(--surface-0)] p-6",children:(0,j.jsx)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:(0,j.jsx)("div",{children:(()=>{var a;let{displayName:b,subtitle:c}={displayName:(a=e).client_last_name||a.client_first_name?`${a.client_last_name??""}${a.client_first_name?`, ${a.client_first_name}`:""}`.trim():a.title||a.client_name,subtitle:[a.matter_type,[a.county,a.state].filter(Boolean).join(", "),a.case_number?`Case #${a.case_number}`:null].filter(Boolean).join(" • ")};return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("h2",{className:"text-3xl font-semibold text-white",children:b}),(0,j.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:c||"Case details"})]})})()})})}),(0,j.jsx)("div",{className:"mt-6 border-b border-[color:var(--border)] text-sm text-[color:var(--muted)]",children:[{key:"overview",label:"Overview"},{key:"notes",label:"Notes"},{key:"documents",label:"Documents"},{key:"tasks",label:"Tasks"},{key:"activity",label:"Activity"}].map(a=>(0,j.jsx)("button",{type:"button",onClick:()=>al(a.key),className:`mr-6 border-b-2 pb-3 transition ${ak===a.key?"border-[color:var(--accent-light)] text-white":"border-transparent hover:text-white"}`,children:a.label},a.key))}),"overview"===ak&&(0,j.jsxs)("div",{className:"mt-6 grid gap-6 md:grid-cols-2",children:[(0,j.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-[var(--surface-0)] p-5",children:[(0,j.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Client"}),(0,j.jsxs)("div",{className:"mt-3 space-y-2 text-sm text-[color:var(--text-2)]",children:[(0,j.jsxs)("p",{children:["First name: ",(0,j.jsx)("span",{className:"text-white",children:e.client_first_name??"—"})]}),(0,j.jsxs)("p",{children:["Last name: ",(0,j.jsx)("span",{className:"text-white",children:e.client_last_name??"—"})]}),(0,j.jsxs)("p",{children:["Email: ",(0,j.jsx)("span",{className:"text-white",children:e.client_email??"—"})]}),(0,j.jsxs)("p",{children:["Phone: ",(0,j.jsx)("span",{className:"text-white",children:e.client_phone??"—"})]})]})]}),(0,j.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-[var(--surface-0)] p-5",children:[(0,j.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Matter"}),(0,j.jsxs)("div",{className:"mt-3 space-y-2 text-sm text-[color:var(--text-2)]",children:[(0,j.jsxs)("p",{children:["Matter type: ",(0,j.jsx)("span",{className:"text-white",children:e.matter_type})]}),(0,j.jsxs)("p",{children:["Status: ",(0,j.jsx)("span",{className:"text-white",children:e.status})]}),(0,j.jsxs)("p",{children:["Created: ",(0,j.jsx)("span",{className:"text-white",children:new Date(e.created_at).toLocaleString()})]}),(0,j.jsxs)("p",{children:["Last updated: ",(0,j.jsx)("span",{className:"text-white",children:new Date(e.updated_at).toLocaleString()})]})]})]}),(0,j.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-[var(--surface-0)] p-5",children:[(0,j.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Jurisdiction"}),(0,j.jsxs)("div",{className:"mt-3 space-y-2 text-sm text-[color:var(--text-2)]",children:[(0,j.jsxs)("p",{children:["State: ",(0,j.jsx)("span",{className:"text-white",children:e.state??"—"})]}),(0,j.jsxs)("p",{children:["County: ",(0,j.jsx)("span",{className:"text-white",children:e.county??"—"})]}),(0,j.jsxs)("p",{children:["Court: ",(0,j.jsx)("span",{className:"text-white",children:e.court_name??"—"})]}),(0,j.jsxs)("p",{children:["Case number: ",(0,j.jsx)("span",{className:"text-white",children:e.case_number??"—"})]})]})]})]}),"notes"===ak&&(0,j.jsxs)("div",{className:"mt-6 rounded-2xl border border-white/10 bg-[var(--surface-0)] p-5",children:[(0,j.jsx)("textarea",{value:am,onChange:a=>an(a.target.value),rows:8,readOnly:!aw,className:"w-full rounded-lg border border-white/10 bg-[var(--surface-1)] px-4 py-3 text-sm text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"}),(0,j.jsx)("p",{className:"mt-3 text-xs text-[color:var(--text-2)]",children:aw?ao??"Autosave enabled.":"Read-only access."})]}),"documents"===ak&&(0,j.jsxs)("div",{className:"mt-6 rounded-2xl border border-white/10 bg-[var(--surface-0)] p-6",children:[A&&(0,j.jsx)("div",{className:"mb-4 rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:A}),E&&(0,j.jsx)("div",{className:"mb-4 rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:E}),C&&(0,j.jsx)("div",{className:"mb-4 rounded-lg border border-white/10 bg-[var(--surface-1)] px-4 py-2 text-sm text-white",children:C}),(0,j.jsx)("div",{className:"grid gap-4",children:y?(0,j.jsx)("p",{className:"text-sm text-[color:var(--text-2)]",children:"Loading documents..."}):0===m.length?(0,j.jsx)("p",{className:"text-sm text-[color:var(--text-2)]",children:"No documents uploaded yet."}):(0,j.jsx)("ul",{className:"divide-y divide-white/10",children:m.map(a=>(0,j.jsxs)("li",{className:"flex flex-col gap-2 py-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("p",{className:"text-sm text-white",children:a.display_name||a.filename}),(0,j.jsxs)("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-xs text-[color:var(--text-2)]",children:[(0,j.jsx)("span",{className:"rounded-full border border-white/15 px-2 py-0.5 uppercase tracking-wide",children:a.doc_type}),a.tags.length>0&&(0,j.jsxs)("span",{children:[a.tags.slice(0,2).join(", "),a.tags.length>2?` +${a.tags.length-2}`:""]})]}),(0,j.jsx)("p",{className:"text-xs text-[color:var(--text-2)]",children:new Date(a.created_at).toLocaleString()})]}),(0,j.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:G===a.id?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("input",{value:I,onChange:a=>J(a.target.value),disabled:!ax,className:"w-full rounded-md border border-white/10 bg-[var(--surface-1)] px-2 py-1 text-xs text-white outline-none",placeholder:"Display name"}),(0,j.jsx)("input",{value:K,onChange:a=>L(a.target.value),disabled:!ax,className:"w-full rounded-md border border-white/10 bg-[var(--surface-1)] px-2 py-1 text-xs text-white outline-none",placeholder:"Type"}),(0,j.jsx)("input",{value:M,onChange:a=>N(a.target.value),disabled:!ax,className:"w-full rounded-md border border-white/10 bg-[var(--surface-1)] px-2 py-1 text-xs text-white outline-none",placeholder:"Tags (comma separated)"}),(0,j.jsx)("button",{onClick:()=>aJ(a.id),disabled:!ax,className:"rounded-lg border border-white/15 px-3 py-2 text-xs font-semibold uppercase tracking-wide text-[color:var(--text-2)] hover:text-white",children:"Save"}),(0,j.jsx)("button",{onClick:()=>H(null),className:"rounded-lg border border-white/10 px-3 py-2 text-xs uppercase tracking-wide text-[color:var(--text-2)] hover:text-white",children:"Cancel"})]}):(0,j.jsxs)(j.Fragment,{children:[ax&&(0,j.jsx)("button",{onClick:()=>{H(a.id),J(a.display_name||a.filename),L(a.doc_type||"other"),N(a.tags.join(", ")),D(null),F(null)},className:"rounded-lg border border-white/15 px-3 py-2 text-xs font-semibold uppercase tracking-wide text-[color:var(--text-2)] hover:text-white",children:"Rename/Edit"}),(0,j.jsx)("button",{onClick:()=>aI(a.id),disabled:ai===a.id,className:"rounded-lg border border-white/15 px-3 py-2 text-xs font-semibold uppercase tracking-wide text-[color:var(--text-2)] hover:text-white disabled:opacity-60",children:ai===a.id?"Preparing…":"Download"}),ay&&(0,j.jsx)("button",{onClick:()=>aK(a.id),className:"rounded-lg border border-red-400/40 px-3 py-2 text-xs font-semibold uppercase tracking-wide text-red-200 hover:text-white",children:"Delete"})]})})]},a.id))})}),(0,j.jsxs)("div",{className:"mt-6 rounded-xl border border-white/10 bg-[var(--surface-1)] p-4",children:[(0,j.jsx)("p",{className:"text-sm text-[color:var(--text-2)]",children:"Upload a document (PDF, image, or doc)."}),aA&&(0,j.jsxs)("div",{className:"mt-3 rounded-lg border border-white/10 bg-[var(--surface-0)] px-3 py-2 text-sm text-[color:var(--text-2)]",children:[az.reason," Upgrade to Pro to upload more documents.",(0,j.jsx)(n(),{href:"/myclient/upgrade",className:"ml-2 text-white underline underline-offset-4",children:"Upgrade"})]}),(0,j.jsxs)("div",{className:"mt-3 flex flex-col gap-3 sm:flex-row sm:items-center",children:[(0,j.jsx)("input",{type:"file",onChange:a=>ad(a.target.files?.[0]??null),disabled:!ax||aA||ag,className:"w-full text-sm text-[color:var(--text-2)] file:mr-4 file:rounded-lg file:border-0 file:bg-[var(--surface-0)] file:px-4 file:py-2 file:text-xs file:font-semibold file:text-white"}),(0,j.jsx)("button",{onClick:aH,disabled:$||!ac||!ax||aA||ag,className:"rounded-lg bg-[color:var(--accent-light)] px-4 py-2 text-sm font-semibold text-white hover:bg-[color:var(--accent)] disabled:opacity-60",children:$?"Uploading…":"Upload"})]}),!ax&&(0,j.jsx)("p",{className:"mt-3 text-sm text-[color:var(--text-2)]",children:"You have read-only access. Please contact your firm admin to upload documents."}),aa&&(0,j.jsx)("p",{className:"mt-3 text-sm text-red-200",children:aa})]})]}),"tasks"===ak&&(0,j.jsxs)("div",{className:"mt-6 space-y-6",children:[Y&&(0,j.jsx)("div",{className:"rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:Y}),!aw&&(0,j.jsx)("p",{className:"text-sm text-[color:var(--text-2)]",children:"Read-only access to tasks."}),aw&&(0,j.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-[var(--surface-0)] p-4",children:[(0,j.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Add task"}),(0,j.jsxs)("div",{className:"mt-3 grid gap-3 sm:grid-cols-[2fr_1fr_auto]",children:[(0,j.jsx)("input",{value:U,onChange:a=>V(a.target.value),placeholder:"Task title",className:"w-full rounded-lg border border-white/10 bg-[var(--surface-1)] px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"}),(0,j.jsx)("input",{type:"date",value:W,onChange:a=>X(a.target.value),className:"w-full rounded-lg border border-white/10 bg-[var(--surface-1)] px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"}),(0,j.jsx)("button",{onClick:aF,className:"rounded-lg bg-[color:var(--accent-light)] px-4 py-2 text-sm font-semibold text-white hover:bg-[color:var(--accent)]",children:"Add"})]})]}),(0,j.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-[var(--surface-0)] p-4",children:[(0,j.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Open tasks"}),Q?(0,j.jsx)("p",{className:"mt-3 text-sm text-[color:var(--text-2)]",children:"Loading tasks..."}):0===O.filter(a=>"open"===a.status).length?(0,j.jsx)("p",{className:"mt-3 text-sm text-[color:var(--text-2)]",children:"No open tasks."}):(0,j.jsx)("ul",{className:"mt-3 space-y-2 text-sm text-[color:var(--text-2)]",children:O.filter(a=>"open"===a.status).map(a=>(0,j.jsxs)("li",{className:"flex flex-col gap-2 rounded-lg border border-white/10 bg-[var(--surface-1)] px-3 py-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("p",{className:"text-white",children:a.title}),a.due_date&&(0,j.jsxs)("p",{className:"text-xs",children:["Due ",new Date(a.due_date).toLocaleDateString()]})]}),aw&&(0,j.jsx)("button",{onClick:()=>aG(a,"done"),className:"rounded-lg border border-white/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-wide text-[color:var(--text-2)] hover:text-white",children:"Mark done"})]},a.id))})]}),(0,j.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-[var(--surface-0)] p-4",children:[(0,j.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Completed"}),0===O.filter(a=>"done"===a.status).length?(0,j.jsx)("p",{className:"mt-3 text-sm text-[color:var(--text-2)]",children:"No completed tasks."}):(0,j.jsx)("ul",{className:"mt-3 space-y-2 text-sm text-[color:var(--text-2)]",children:O.filter(a=>"done"===a.status).map(a=>(0,j.jsxs)("li",{className:"flex flex-col gap-2 rounded-lg border border-white/10 bg-[var(--surface-1)] px-3 py-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("p",{className:"text-white",children:a.title}),a.completed_at&&(0,j.jsxs)("p",{className:"text-xs",children:["Completed ",new Date(a.completed_at).toLocaleDateString()]})]}),aw&&(0,j.jsx)("button",{onClick:()=>aG(a,"open"),className:"rounded-lg border border-white/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-wide text-[color:var(--text-2)] hover:text-white",children:"Reopen"})]},a.id))})]}),S&&(0,j.jsx)("div",{className:"rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:S})]}),"activity"===ak&&(0,j.jsxs)("div",{className:"mt-6 rounded-2xl border border-white/10 bg-[var(--surface-0)] p-6",children:[au&&(0,j.jsx)("div",{className:"mb-4 rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:au}),as?(0,j.jsx)("p",{className:"text-sm text-[color:var(--text-2)]",children:"Loading activity…"}):0===aq.length?(0,j.jsx)("p",{className:"text-sm text-[color:var(--text-2)]",children:"No activity yet."}):(0,j.jsx)("ul",{className:"space-y-4",children:aq.map(a=>{let b="case_created"===a.event_type?"Created":"case_updated"===a.event_type?"Updated":"Document";return(0,j.jsx)("li",{className:"rounded-xl border border-white/10 bg-[var(--surface-1)] p-4",children:(0,j.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("p",{className:"text-sm text-white",children:a.message}),(0,j.jsx)("p",{className:"text-xs text-[color:var(--text-2)]",children:new Date(a.created_at).toLocaleString()})]}),(0,j.jsx)("span",{className:"rounded-full border border-white/15 px-2 py-1 text-xs uppercase tracking-wide text-[color:var(--text-2)]",children:b})]})},a.id)})})]})]}),i&&(0,j.jsx)("div",{className:"mt-6 rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:i})]})]})}var y=c(6104);let z=(0,g.M)(d,"default"),A=(0,g.M)(d,"getStaticProps"),B=(0,g.M)(d,"getStaticPaths"),C=(0,g.M)(d,"getServerSideProps"),D=(0,g.M)(d,"config"),E=(0,g.M)(d,"reportWebVitals"),F=(0,g.M)(d,"unstable_getStaticProps"),G=(0,g.M)(d,"unstable_getStaticPaths"),H=(0,g.M)(d,"unstable_getStaticParams"),I=(0,g.M)(d,"unstable_getServerProps"),J=(0,g.M)(d,"unstable_getServerSideProps"),K=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/myclient/cases/[id]",pathname:"/myclient/cases/[id]",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:i.default,Document:h.default},userland:d}),L=(0,y.U)({srcPage:"/myclient/cases/[id]",config:D,userland:d,routeModule:K,getStaticPaths:B,getStaticProps:A,getServerSideProps:C})},3873:a=>{"use strict";a.exports=require("path")},3939:a=>{"use strict";a.exports=require("@supabase/supabase-js")},4075:a=>{"use strict";a.exports=require("zlib")},5833:(a,b,c)=>{"use strict";function d(a){if("string"!=typeof a)return null;let b=a.toLowerCase();return"admin"===b||"attorney"===b||"staff"===b?b:null}function e(a){let b=d(a);return"admin"===b||"attorney"===b}function f(a){let b=d(a);return"admin"===b||"attorney"===b}function g(a){let b=d(a);return"admin"===b||"attorney"===b}function h(a){return"admin"===d(a)}c.d(b,{TX:()=>f,Ue:()=>e,gL:()=>g,jR:()=>h})},6060:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},7910:a=>{"use strict";a.exports=require("stream")},8688:(a,b,c)=>{"use strict";async function d(a,b){try{await a.from("case_activity").insert({firm_id:b.firm_id,case_id:b.case_id??null,actor_user_id:b.actor_user_id??null,event_type:b.event_type,message:b.message,metadata:b.metadata??{}})}catch{}}c.d(b,{M:()=>d})},8732:a=>{"use strict";a.exports=require("react/jsx-runtime")},9021:a=>{"use strict";a.exports=require("fs")},9247:(a,b,c)=>{a.exports=c(6186)},9382:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>f});var d=c(8732),e=c(6030);function f(){return(0,d.jsxs)(e.Html,{lang:"en",children:[(0,d.jsx)(e.Head,{children:(0,d.jsx)("link",{rel:"icon",href:"/favicon.svg",type:"image/svg+xml"})}),(0,d.jsxs)("body",{children:[(0,d.jsx)(e.Main,{}),(0,d.jsx)(e.NextScript,{})]})]})}}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[978,708,30,791,627],()=>b(b.s=3865));module.exports=c})();