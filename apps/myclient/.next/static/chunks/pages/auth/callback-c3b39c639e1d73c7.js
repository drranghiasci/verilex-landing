(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[620],{3957:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth/callback",function(){return a(4163)}])},4163:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var r=a(6029),i=a(5669),s=a.n(i),n=a(1278),o=a(5729),l=a(5054);function c(){let e=(0,n.useRouter)(),[t,a]=(0,o.useState)("auth"),[i,c]=(0,o.useState)("Finishing sign-in…"),[h,u]=(0,o.useState)("signIn"),d=(0,o.useCallback)(async()=>{a("auth"),c("Finishing sign-in…"),u("signIn");try{let{accessToken:t,refreshToken:r}=(e=>{var t,a;let r=new URLSearchParams(e.startsWith("#")?e.slice(1):e);return{accessToken:null!=(t=r.get("access_token"))?t:void 0,refreshToken:null!=(a=r.get("refresh_token"))?a:void 0}})(window.location.hash);if(t&&r){let{error:e}=await l.N.auth.setSession({access_token:t,refresh_token:r}),{data:a}=await l.N.auth.getSession();if(!a.session)throw Error((null==e?void 0:e.message)?"Unable to complete sign-in: ".concat(e.message):"Unable to complete sign-in. Please try the invite link again.");window.history.replaceState({},document.title,window.location.pathname+window.location.search)}else{let e=l.N.auth.exchangeCodeForSession;if("function"==typeof e){let{error:t}=await e(window.location.href);if(t)throw t}let{data:t}=await l.N.auth.getSession();if(!t.session)throw Error("We could not complete sign-in. Please try the invite link again.")}a("claim"),c("Claiming firm access…"),u("claim");let{error:i}=await l.N.rpc("claim_firm_membership");if(i)throw i;u("redirect"),e.replace("/myclient/app")}catch(e){console.error("Auth callback error",e),a("error"),c(e instanceof Error?e.message:"Unable to finish sign-in. Please try again.")}},[e]);return(0,o.useEffect)(()=>{e.isReady&&d()},[e.isReady,d]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s(),{children:(0,r.jsx)("title",{children:"MyClient"})}),(0,r.jsx)("div",{className:"min-h-screen bg-[var(--surface-0)] px-6 py-20 text-[color:var(--text-1)]",children:(0,r.jsxs)("div",{className:"mx-auto max-w-md rounded-3xl border border-white/10 bg-[var(--surface-1)] p-8 text-center shadow-2xl",children:[(0,r.jsx)("p",{className:"text-sm uppercase tracking-[0.35em] text-[color:var(--accent-soft)]",children:"MyClient"}),(0,r.jsx)("h1",{className:"mt-4 text-3xl font-semibold text-white",children:"error"===t?"Setup failed":"Finishing setup"}),(0,r.jsxs)("p",{className:"mt-3 text-xs uppercase tracking-[0.2em] text-[color:var(--text-2)]",children:["Step: ",h]}),(0,r.jsx)("p",{className:"mt-4 text-[color:var(--text-2)]",children:i}),"error"===t&&(0,r.jsx)("button",{onClick:d,className:"mt-6 w-full rounded-lg bg-[color:var(--accent-light)] px-4 py-2 font-semibold text-white hover:bg-[color:var(--accent)] transition",children:"Try again"})]})})]})}},5669:(e,t,a)=>{e.exports=a(4807)}},e=>{e.O(0,[636,593,792],()=>e(e.s=3957)),_N_E=e.O()}]);