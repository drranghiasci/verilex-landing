(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[891],{4859:(e,r,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/myclient/app",function(){return s(8306)}])},5669:(e,r,s)=>{e.exports=s(4807)},8306:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>m});var t=s(6029),a=s(5669),l=s.n(a),i=s(2203),c=s.n(i),d=s(5729),o=s(5054),n=s(8638);function m(){let{state:e,refresh:r}=(0,n._)(),[s,a]=(0,d.useState)(null),[i,m]=(0,d.useState)([]),[x,h]=(0,d.useState)(null);(0,d.useEffect)(()=>{if(!e.authed||!e.firmId)return;let r=!0;return(async()=>{h(null);let{data:s,error:t}=await o.N.from("case_tasks").select("id, title, due_date, case_id").eq("firm_id",e.firmId).eq("status","open").order("due_date",{ascending:!0,nullsFirst:!1}).order("created_at",{ascending:!1}).limit(5);r&&(t?(h(t.message),m([])):m(null!=s?s:[]))})(),()=>{r=!1}},[e.authed,e.firmId]);let u=async e=>{var r;let{data:s}=await o.N.from("firm_members").select("firm_id, role").eq("user_id",e).limit(1),t=Array.isArray(s)&&s.length>0?s[0]:null;return null!=(r=null==t?void 0:t.firm_id)?r:null},f=async()=>{a("Claimingâ€¦");try{let{error:s}=await o.N.rpc("claim_firm_membership");if(s){if(s.message.includes("No pending invite found")&&(await r(),e.userId?await u(e.userId):null))return void a("Claimed");a("Error: ".concat(s.message));return}await r(),a("Claimed")}catch(e){console.error("Claim firm access failed",e),a("Error: ".concat(e instanceof Error?e.message:"Unable to claim access."))}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l(),{children:(0,t.jsx)("title",{children:"MyClient"})}),(0,t.jsxs)("div",{className:"mx-auto max-w-6xl space-y-8",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold text-[color:var(--text)]",children:"Dashboard"}),(0,t.jsx)("p",{className:"text-sm text-[color:var(--muted)]",children:"Overview of your firm workspace."})]}),e.firmId?(0,t.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[1.2fr_1fr]",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-8 shadow-sm",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Today's Snapshot"}),(0,t.jsx)("p",{className:"mt-3 text-[color:var(--muted)]",children:"Your firm's latest activity and workload trends will appear here soon."}),(0,t.jsx)("div",{className:"mt-6 grid gap-4 sm:grid-cols-2",children:["Active Cases","Upcoming Deadlines","Client Messages","Documents Reviewed"].map(e=>(0,t.jsxs)("div",{className:"rounded-2xl border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-sm text-[color:var(--muted)]",children:[(0,t.jsx)("p",{className:"text-white",children:e}),(0,t.jsx)("p",{className:"mt-2 text-[color:var(--muted-2)]",children:"Coming soon"})]},e))})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-8 shadow-sm",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Quick Actions"}),(0,t.jsx)("div",{className:"mt-6 grid gap-4",children:[{label:"Active Cases",href:"/myclient/cases"},{label:"New Case Intake",href:"/myclient/intake"},{label:"Documents",href:"/myclient/documents"},{label:"Members",href:"/myclient/members"},{label:"Profile",href:"/myclient/profile"},{label:"Activity",href:"/myclient/activity"}].map(e=>(0,t.jsx)(c(),{href:e.href,className:"rounded-2xl border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-sm text-[color:var(--text)] hover:bg-white/10 transition",children:(0,t.jsx)("div",{className:"font-medium text-white",children:e.label})},e.label))})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-6 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Open Tasks"}),(0,t.jsx)(c(),{href:"/myclient/cases",className:"text-xs text-[color:var(--muted)] hover:text-white transition",children:"View cases"})]}),x&&(0,t.jsx)("p",{className:"mt-3 text-xs text-red-300",children:x}),0===i.length?(0,t.jsx)("p",{className:"mt-4 text-sm text-[color:var(--muted)]",children:"No open tasks."}):(0,t.jsx)("ul",{className:"mt-4 space-y-3 text-sm text-[color:var(--muted)]",children:i.map(e=>(0,t.jsx)("li",{className:"rounded-xl border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2",children:(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("p",{className:"text-white",children:e.title}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-[color:var(--muted-2)]",children:[e.due_date&&(0,t.jsxs)("span",{children:["Due ",new Date(e.due_date).toLocaleDateString()]}),(0,t.jsx)(c(),{href:"/myclient/cases/".concat(e.case_id),className:"hover:text-white",children:"View case"})]})]})},e.id))}),e.role&&("admin"===e.role||"attorney"===e.role)&&(0,t.jsx)("p",{className:"mt-3 text-xs text-[color:var(--muted-2)]",children:"Add tasks from within a case."})]})]})]}):(0,t.jsxs)("div",{className:"rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-8 text-center shadow-sm",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold text-white",children:"No firm linked yet"}),(0,t.jsx)("p",{className:"mt-3 text-[color:var(--muted)]",children:"We're finalizing your access. If you're stuck, finalize firm access below."}),(0,t.jsx)("button",{onClick:f,className:"mt-6 inline-flex items-center justify-center rounded-lg border border-[color:var(--border)] px-4 py-2 font-semibold text-white hover:bg-white/10 transition",children:"Finalize Firm Access"}),s&&(0,t.jsx)("p",{className:"mt-4 text-sm ".concat(s.startsWith("Error")?"text-red-300":"Claimed"===s?"text-green-300":"text-[color:var(--muted)]"),children:s})]}),e.error&&(0,t.jsxs)("p",{className:"text-sm text-red-300",children:["Error: ",e.error]})]})]})}}},e=>{e.O(0,[636,593,792],()=>e(e.s=4859)),_N_E=e.O()}]);