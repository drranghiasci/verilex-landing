(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[343],{1320:(e,t,r)=>{"use strict";function a(e){if("string"!=typeof e)return null;let t=e.toLowerCase();return"admin"===t||"attorney"===t||"staff"===t?t:null}function s(e){let t=a(e);return"admin"===t||"attorney"===t}function n(e){let t=a(e);return"admin"===t||"attorney"===t}function o(e){let t=a(e);return"admin"===t||"attorney"===t}function i(e){return"admin"===a(e)}r.d(t,{TX:()=>n,Ue:()=>s,gL:()=>o,jR:()=>i})},3668:(e,t,r)=>{"use strict";r.d(t,{b:()=>i});var a=r(5729),s=r(5054),n=r(8638);let o="free";function i(){let{state:e}=(0,n._)(),[t,r]=(0,a.useState)({plan:o,loading:!0,error:null}),i=(0,a.useCallback)(async()=>{var t;if(!e.authed||!e.firmId)return void r({plan:o,loading:!1,error:null});r(e=>({...e,loading:!0,error:null}));let{data:a,error:n}=await s.N.from("firms").select("plan").eq("id",e.firmId).single();if(n)return void r({plan:o,loading:!1,error:n.message});r({plan:null!=(t=null==a?void 0:a.plan)?t:o,loading:!1,error:null})},[e.authed,e.firmId]);return(0,a.useEffect)(()=>{i()},[i]),t}},4799:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/myclient/members",function(){return r(6566)}])},5669:(e,t,r)=>{e.exports=r(4807)},6566:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var a=r(6029),s=r(5669),n=r.n(s),o=r(2203),i=r.n(o),l=r(5729),d=r(8638),c=r(5054),m=r(1320),u=r(3668),x=r(6660);function h(){var e;let{state:t}=(0,d._)(),{plan:r,loading:s}=(0,u.b)(),[o,h]=(0,l.useState)([]),[p,f]=(0,l.useState)(!1),[v,b]=(0,l.useState)(null),[g,j]=(0,l.useState)(""),[y,N]=(0,l.useState)("attorney"),[w,k]=(0,l.useState)(null),[_,S]=(0,l.useState)([]),[C,I]=(0,l.useState)(!1),[P,A]=(0,l.useState)({}),M=(0,m.jR)(t.role),D=(0,x.wq)({plan:r,currentMemberCount:o.length}),T=!s&&!D.ok,E=(0,l.useMemo)(()=>t.firmId?t.firmId.slice(0,8):"No firm",[t.firmId]);(0,l.useEffect)(()=>{if(!t.authed||!t.firmId||"admin"!==t.role)return;let e=!0;return(async()=>{var t;f(!0),b(null);let{data:r,error:a}=await c.N.auth.getSession();if(a||!(null==(t=r.session)?void 0:t.access_token)){e&&(b((null==a?void 0:a.message)||"Please sign in to view members."),f(!1));return}let s=await fetch("/api/myclient/members/list",{method:"POST",headers:{Authorization:"Bearer ".concat(r.session.access_token)}}),n=await s.json().catch(()=>({}));if(!s.ok||!n.ok){e&&(b(n.error||"Unable to load members."),h([]),f(!1));return}e&&(h(Array.isArray(n.members)?n.members:[]),f(!1))})(),()=>{e=!1}},[t.authed,t.firmId,t.role]),(0,l.useEffect)(()=>{if(!t.authed||!t.firmId||"admin"!==t.role)return;let e=!0;return(async()=>{var t;I(!0);let{data:r,error:a}=await c.N.auth.getSession();if(a||!(null==(t=r.session)?void 0:t.access_token)){e&&I(!1);return}let s=await fetch("/api/myclient/members/pending",{method:"POST",headers:{Authorization:"Bearer ".concat(r.session.access_token)}}),n=await s.json().catch(()=>({}));if(!s.ok||!n.ok){e&&(S([]),I(!1));return}e&&(S(Array.isArray(n.invites)?n.invites:[]),I(!1))})(),()=>{e=!1}},[t.authed,t.firmId,t.role]);let O=async()=>{var e;if(k(null),T)return void k("".concat(D.reason," Upgrade to Pro to add more members."));let{data:t,error:r}=await c.N.auth.getSession();if(r||!(null==(e=t.session)?void 0:e.access_token))return void k((null==r?void 0:r.message)||"Please sign in to invite members.");let a=await fetch("/api/myclient/members/invite",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.session.access_token)},body:JSON.stringify({email:g,role:y})}),s=await a.json().catch(()=>({}));if(!a.ok||!s.ok)return void k(s.error||"Unable to send invite.");k("Invite sent."),j("");let n=await fetch("/api/myclient/members/pending",{method:"POST",headers:{Authorization:"Bearer ".concat(t.session.access_token)}}),o=await n.json().catch(()=>({}));n.ok&&o.ok&&S(Array.isArray(o.invites)?o.invites:[])},F=async e=>{var t;if(A(t=>({...t,[e.id]:"Sending…"})),T)return void A(t=>({...t,[e.id]:"".concat(D.reason," Upgrade to Pro.")}));let{data:r,error:a}=await c.N.auth.getSession();if(a||!(null==(t=r.session)?void 0:t.access_token))return void A(t=>({...t,[e.id]:(null==a?void 0:a.message)||"Sign in required"}));let s=await fetch("/api/myclient/members/resend-invite",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.session.access_token)},body:JSON.stringify({email:e.email,role:e.role})}),n=await s.json().catch(()=>({}));if(!s.ok||!n.ok)return void A(t=>({...t,[e.id]:n.error||"Unable to resend invite."}));A(t=>({...t,[e.id]:"Sent"}))};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n(),{children:(0,a.jsx)("title",{children:"MyClient | Members"})}),(0,a.jsxs)("div",{className:"mx-auto max-w-6xl rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-8 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsx)(i(),{href:"/myclient/app",className:"text-sm text-[color:var(--muted)] hover:text-white transition",children:"← Back"}),(0,a.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Firm Members"})]}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:["Firm ",E," \xb7 Role ",null!=(e=t.role)?e:"member"]}),t.loading&&(0,a.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Loading..."}),!t.loading&&!t.authed&&(0,a.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Please sign in."}),!t.loading&&t.authed&&!t.firmId&&(0,a.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"No firm linked yet."}),!t.loading&&t.authed&&t.firmId&&!M&&(0,a.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Member management is admin-only. Please contact an admin for invites or changes."}),v&&(0,a.jsx)("div",{className:"mt-6 rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:v}),t.authed&&t.firmId&&M&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mt-6 rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Invite team member"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-[color:var(--muted)]",children:"Send an invite to join this firm."}),T&&(0,a.jsxs)("div",{className:"mt-3 rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-[color:var(--muted)]",children:[D.reason," Upgrade to Pro to invite more members.",(0,a.jsx)(i(),{href:"/myclient/upgrade",className:"ml-2 text-white underline underline-offset-4",children:"Upgrade"})]}),(0,a.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-[2fr_1fr_auto]",children:[(0,a.jsx)("input",{type:"email",value:g,onChange:e=>j(e.target.value),disabled:T,placeholder:"teammate@firm.com",className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"}),(0,a.jsxs)("select",{value:y,onChange:e=>N(e.target.value),disabled:T,className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:[(0,a.jsx)("option",{value:"admin",children:"Admin"}),(0,a.jsx)("option",{value:"attorney",children:"Attorney"}),(0,a.jsx)("option",{value:"staff",children:"Staff"})]}),(0,a.jsx)("button",{type:"button",onClick:O,disabled:T,className:"rounded-lg bg-[color:var(--accent-light)] px-4 py-2 text-sm font-semibold text-white hover:bg-[color:var(--accent)] disabled:opacity-60",children:"Send invite"})]}),w&&(0,a.jsx)("p",{className:"mt-3 text-sm text-[color:var(--text-2)]",children:w}),(0,a.jsx)("p",{className:"mt-3 text-sm text-[color:var(--text-2)]",children:"If a user already has an account but can’t sign in, ask them to use the ‘Forgot password’ link on the sign-in page to set a password."})]}),(0,a.jsx)("div",{className:"mt-6 overflow-hidden rounded-2xl border border-[color:var(--border)]",children:p?(0,a.jsx)("p",{className:"px-4 py-6 text-[color:var(--text-2)]",children:"Loading..."}):0===o.length?(0,a.jsx)("p",{className:"px-4 py-6 text-[color:var(--text-2)]",children:"No members found."}):(0,a.jsxs)("table",{className:"min-w-full divide-y divide-white/10 text-left text-sm",children:[(0,a.jsx)("thead",{className:"text-[color:var(--text-2)]",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Name"}),(0,a.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Email"}),(0,a.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Role"}),(0,a.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Added"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-white/5 text-[color:var(--text-1)]",children:o.map(e=>{var t,r;let s=e.user_id.slice(0,8);return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-3 text-white",children:null!=(t=e.full_name)?t:"—"}),(0,a.jsx)("td",{className:"px-4 py-3 text-[color:var(--text-2)]",children:null!=(r=e.email)?r:"ID: ".concat(s)}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("span",{className:"rounded-full border border-[color:var(--border)] bg-[var(--surface-0)] px-2 py-1 text-xs uppercase tracking-wide text-[color:var(--muted)]",children:e.role})}),(0,a.jsx)("td",{className:"px-4 py-3 text-[color:var(--text-2)]",children:new Date(e.created_at).toLocaleDateString()})]},e.user_id)})})]})}),(0,a.jsx)("p",{className:"mt-4 text-sm text-[color:var(--text-2)]",children:"Names appear once users complete their profile."}),(0,a.jsxs)("div",{className:"mt-6 rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Pending invites"}),C?(0,a.jsx)("p",{className:"mt-3 text-sm text-[color:var(--text-2)]",children:"Loading invites…"}):0===_.length?(0,a.jsx)("p",{className:"mt-3 text-sm text-[color:var(--text-2)]",children:"No pending invites."}):(0,a.jsx)("ul",{className:"mt-3 space-y-2 text-sm text-[color:var(--text-2)]",children:_.map(e=>(0,a.jsxs)("li",{className:"flex flex-wrap items-center justify-between gap-2 rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2",children:[(0,a.jsx)("span",{children:e.email}),(0,a.jsx)("span",{className:"rounded-full border border-[color:var(--border)] px-2 py-1 text-xs uppercase tracking-wide text-[color:var(--muted)]",children:e.role}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-xs text-[color:var(--text-2)]",children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)("button",{type:"button",onClick:()=>F(e),disabled:T,className:"rounded-lg border border-[color:var(--border)] px-2 py-1 text-xs font-semibold uppercase tracking-wide text-[color:var(--muted)] hover:text-white disabled:opacity-60",children:"Resend"}),P[e.id]&&(0,a.jsx)("span",{className:"text-xs text-[color:var(--text-2)]",children:P[e.id]})]})]},e.id))})]})]})]})]})}},6660:(e,t,r)=>{"use strict";r.d(t,{HK:()=>a,Z8:()=>n,nh:()=>i,wq:()=>o});let a={free:{maxCases:25,maxMembers:3,maxDocuments:200},pro:null,enterprise:null};function s(e){return null===a[e]}function n(e){return s(e.plan)?{ok:!0}:e.currentCaseCount>=a[e.plan].maxCases?{ok:!1,reason:"Case limit reached for Free plan (".concat(a[e.plan].maxCases,").")}:{ok:!0}}function o(e){return s(e.plan)?{ok:!0}:e.currentMemberCount>=a[e.plan].maxMembers?{ok:!1,reason:"Member limit reached for Free plan (".concat(a[e.plan].maxMembers,").")}:{ok:!0}}function i(e){return s(e.plan)?{ok:!0}:e.currentDocumentCount>=a[e.plan].maxDocuments?{ok:!1,reason:"Document limit reached for Free plan (".concat(a[e.plan].maxDocuments,").")}:{ok:!0}}}},e=>{e.O(0,[636,593,792],()=>e(e.s=4799)),_N_E=e.O()}]);