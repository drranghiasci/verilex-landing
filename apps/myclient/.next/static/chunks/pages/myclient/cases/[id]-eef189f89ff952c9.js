(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{945:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/myclient/cases/[id]",function(){return a(8662)}])},1320:(e,t,a)=>{"use strict";function r(e){if("string"!=typeof e)return null;let t=e.toLowerCase();return"admin"===t||"attorney"===t||"staff"===t?t:null}function s(e){let t=r(e);return"admin"===t||"attorney"===t}function l(e){let t=r(e);return"admin"===t||"attorney"===t}function n(e){let t=r(e);return"admin"===t||"attorney"===t}function i(e){return"admin"===r(e)}a.d(t,{TX:()=>l,Ue:()=>s,gL:()=>n,jR:()=>i})},3668:(e,t,a)=>{"use strict";a.d(t,{b:()=>i});var r=a(5729),s=a(5054),l=a(8638);let n="free";function i(){let{state:e}=(0,l._)(),[t,a]=(0,r.useState)({plan:n,loading:!0,error:null}),i=(0,r.useCallback)(async()=>{var t;if(!e.authed||!e.firmId)return void a({plan:n,loading:!1,error:null});a(e=>({...e,loading:!0,error:null}));let{data:r,error:l}=await s.N.from("firms").select("plan").eq("id",e.firmId).single();if(l)return void a({plan:n,loading:!1,error:l.message});a({plan:null!=(t=null==r?void 0:r.plan)?t:n,loading:!1,error:null})},[e.authed,e.firmId]);return(0,r.useEffect)(()=>{i()},[i]),t}},5669:(e,t,a)=>{e.exports=a(4807)},6660:(e,t,a)=>{"use strict";a.d(t,{HK:()=>r,Z8:()=>l,nh:()=>i,wq:()=>n});let r={free:{maxCases:25,maxMembers:3,maxDocuments:200},pro:null,enterprise:null};function s(e){return null===r[e]}function l(e){return s(e.plan)?{ok:!0}:e.currentCaseCount>=r[e.plan].maxCases?{ok:!1,reason:"Case limit reached for Free plan (".concat(r[e.plan].maxCases,").")}:{ok:!0}}function n(e){return s(e.plan)?{ok:!0}:e.currentMemberCount>=r[e.plan].maxMembers?{ok:!1,reason:"Member limit reached for Free plan (".concat(r[e.plan].maxMembers,").")}:{ok:!0}}function i(e){return s(e.plan)?{ok:!0}:e.currentDocumentCount>=r[e.plan].maxDocuments?{ok:!1,reason:"Document limit reached for Free plan (".concat(r[e.plan].maxDocuments,").")}:{ok:!0}}},8662:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>v});var r=a(6029),s=a(5669),l=a.n(s),n=a(2203),i=a.n(n),d=a(1278),o=a(5729),c=a(5054),m=a(8638),u=a(1320),x=a(9845),p=a(3668),h=a(6660);let f={open:"border-emerald-400/40 text-emerald-200",paused:"border-amber-400/40 text-amber-200",closed:"border-slate-400/40 text-slate-200"};function v(){var e,t,a,s,n,v,g,b,_;let y=(0,d.useRouter)(),{state:w}=(0,m._)(),{plan:N,loading:j}=(0,p.b)(),[k,S]=(0,o.useState)(null),[C,I]=(0,o.useState)(!0),[D,P]=(0,o.useState)(null),[E,T]=(0,o.useState)([]),[U,q]=(0,o.useState)(!1),[L,M]=(0,o.useState)(null),[Y,F]=(0,o.useState)(null),[O,A]=(0,o.useState)(null),[R,z]=(0,o.useState)(null),[B,X]=(0,o.useState)(""),[J,Z]=(0,o.useState)("other"),[H,K]=(0,o.useState)(""),[G,Q]=(0,o.useState)([]),[V,W]=(0,o.useState)(!1),[$,ee]=(0,o.useState)(null),[et,ea]=(0,o.useState)(""),[er,es]=(0,o.useState)(""),[el,en]=(0,o.useState)(null),[ei,ed]=(0,o.useState)(!1),[eo,ec]=(0,o.useState)(null),[em,eu]=(0,o.useState)(null),[ex,ep]=(0,o.useState)(null),[eh,ef]=(0,o.useState)(!1),[ev,eg]=(0,o.useState)(null),[eb,e_]=(0,o.useState)("overview"),[ey,ew]=(0,o.useState)(""),[eN,ej]=(0,o.useState)(null),ek=(0,o.useRef)(!1),[eS,eC]=(0,o.useState)([]),[eI,eD]=(0,o.useState)(!1),[eP,eE]=(0,o.useState)(null),eT=(0,u.Ue)(w.role),eU=(0,u.TX)(w.role),eq=(0,u.gL)(w.role),eL=null===ex?{ok:!0}:(0,h.nh)({plan:N,currentDocumentCount:ex}),eM=!j&&null!==ex&&!eL.ok,eY=e=>{if(!e)return!1;let t=e.toLowerCase();return t.includes("permission")||t.includes("policy")||t.includes("not allowed")},eF=(0,o.useMemo)(()=>"string"==typeof y.query.id?y.query.id:null,[y.query.id]),eO=(0,o.useCallback)(async()=>{if(!w.authed||!w.firmId)return;ef(!0);let{count:e,error:t}=await c.N.from("case_documents").select("id",{count:"exact",head:!0}).eq("firm_id",w.firmId).is("deleted_at",null);t?ep(null):ep(null!=e?e:0),ef(!1)},[w.authed,w.firmId]);(0,o.useEffect)(()=>{eO()},[eO]),(0,o.useEffect)(()=>{if(!w.authed||!w.firmId||!eF)return void I(!1);let e=!0;return(async()=>{I(!0),P(null);let{data:t,error:a}=await c.N.from("cases").select("id, firm_id, client_name, client_first_name, client_last_name, client_email, client_phone, title, matter_type, status, intake_summary, internal_notes, state, county, court_name, case_number, last_activity_at, created_at, updated_at").eq("id",eF).limit(1);e&&(a?(P(a.message),S(null)):S(Array.isArray(t)&&t.length>0?t[0]:null),I(!1))})(),()=>{e=!1}},[w.authed,w.firmId,eF]);let eA=(0,o.useCallback)(async()=>{if(!w.authed||!w.firmId||!eF)return;q(!0),M(null);let{data:e,error:t}=await c.N.from("case_documents").select("id, filename, display_name, doc_type, tags, storage_path, created_at").eq("case_id",eF).eq("firm_id",w.firmId).not("storage_path","is",null).is("deleted_at",null).order("created_at",{ascending:!1});t?(M(t.message),T([])):T((null!=e?e:[]).map(e=>{var t,a,r;return{...e,display_name:null!=(t=e.display_name)?t:null,doc_type:null!=(a=e.doc_type)?a:"other",tags:null!=(r=e.tags)?r:[]}})),q(!1)},[eF,w.authed,w.firmId]);(0,o.useEffect)(()=>{eA()},[eA]),(0,o.useEffect)(()=>{var e;if(!k)return;ek.current=!1,ew(null!=(e=k.internal_notes)?e:""),ej(null);let t=setTimeout(()=>{ek.current=!0},0);return()=>clearTimeout(t)},[null==k?void 0:k.id]),(0,o.useEffect)(()=>{if(!k||!ek.current||!eT)return;let e=setTimeout(async()=>{var e,t,a,r,s,l,n;if(ey!==(null!=(e=k.internal_notes)?e:"")){ej("Saving…");try{let{data:e,error:i}=await c.N.auth.getSession();if(i)return void ej("Error saving");let d=null==(t=e.session)?void 0:t.access_token;if(!d)return void ej("Error saving");let o="".concat(null!=(a=k.client_first_name)?a:""," ").concat(null!=(r=k.client_last_name)?r:"").trim(),{error:m}=await c.N.from("cases").update({client_name:o||k.client_name,internal_notes:ey,last_activity_at:new Date().toISOString()}).eq("id",k.id);if(m){ej("Error saving"),eY(m.message)&&P("You don’t have permission to perform this action. Please contact your firm admin.");return}S(e=>e?{...e,internal_notes:ey}:e),ej("Saved");try{await c.N.from("case_activity").insert({firm_id:k.firm_id,case_id:k.id,actor_user_id:d&&null!=(n=null==(l=e.session)||null==(s=l.user)?void 0:s.id)?n:null,event_type:"case_updated",message:"Notes updated",metadata:{field:"internal_notes"}})}catch(e){}}catch(e){ej("Error saving")}}},800);return()=>clearTimeout(e)},[ey,k]);let eR=(0,o.useCallback)(async()=>{if(!w.authed||!w.firmId||!eF)return;eD(!0),eE(null);let{data:e,error:t}=await c.N.from("case_activity").select("id, event_type, message, created_at").eq("case_id",eF).order("created_at",{ascending:!1}).limit(50);t?(eE(t.message),eC([])):eC(null!=e?e:[]),eD(!1)},[eF,w.authed,w.firmId]);(0,o.useEffect)(()=>{"activity"===eb&&eR()},[eb,eR]);let ez=(0,o.useCallback)(async()=>{if(!w.authed||!w.firmId||!eF)return;W(!0),ee(null);let{data:e,error:t}=await c.N.from("case_tasks").select("id, title, status, due_date, completed_at, created_at").eq("case_id",eF).eq("firm_id",w.firmId).order("status",{ascending:!0}).order("due_date",{ascending:!0,nullsFirst:!1}).order("created_at",{ascending:!1});t?(ee(t.message),Q([])):Q(null!=e?e:[]),W(!1)},[eF,w.authed,w.firmId]);(0,o.useEffect)(()=>{"tasks"===eb&&ez()},[eb,ez]);let eB=async()=>{var e,t,a;if(en(null),!et.trim())return void en("Task title is required.");if(!k||!w.firmId)return;if(!eT)return void en("You don’t have permission to perform this action. Please contact your firm admin.");let{data:r}=await c.N.auth.getSession(),s=null!=(a=null==(t=r.session)||null==(e=t.user)?void 0:e.id)?a:null,{data:l,error:n}=await c.N.from("case_tasks").insert({firm_id:w.firmId,case_id:k.id,title:et.trim(),due_date:er||null,created_by:s}).select("id, title, status, due_date, completed_at, created_at").single();if(n||!l)return void en(eY(null==n?void 0:n.message)?"You don’t have permission to perform this action. Please contact your firm admin.":(null==n?void 0:n.message)||"Unable to add task.");Q(e=>[l,...e]),ea(""),es(""),await (0,x.M)(c.N,{firm_id:w.firmId,case_id:k.id,actor_user_id:s,event_type:"task_created",message:"Task created: ".concat(l.title),metadata:{due_date:l.due_date}})},eX=async(e,t)=>{if(en(null),!k||!w.firmId)return;if(!eT)return void en("You don’t have permission to perform this action. Please contact your firm admin.");let a="done"===t?{status:"done",completed_at:new Date().toISOString()}:{status:"open",completed_at:null},{error:r}=await c.N.from("case_tasks").update(a).eq("id",e.id);if(r)return void en(eY(r.message)?"You don’t have permission to perform this action. Please contact your firm admin.":r.message);Q(t=>t.map(t=>t.id===e.id?{...t,...a}:t)),await (0,x.M)(c.N,{firm_id:w.firmId,case_id:k.id,actor_user_id:w.userId,event_type:"task_completed",message:"done"===t?"Task completed: ".concat(e.title):"Task reopened: ".concat(e.title),metadata:{}})},eJ=async()=>{if(!eF||!em)return void ec("Please choose a file to upload.");if(!w.firmId)return void ec("No firm linked yet.");if(!eU)return void ec("You don’t have permission to perform this action. Please contact your firm admin.");if(eM)return void ec("".concat(eL.reason," Upgrade to Pro to upload more documents."));ed(!0),ec(null);try{var e,t,a;let{data:r}=await c.N.auth.getSession(),s=null!=(a=null==(t=r.session)||null==(e=t.user)?void 0:e.id)?a:null,{data:l,error:n}=await c.N.from("case_documents").insert({firm_id:w.firmId,case_id:eF,filename:em.name,display_name:em.name,doc_type:"other",tags:[],storage_path:null}).select("id").single();if(n||!(null==l?void 0:l.id))return void ec(eY(null==n?void 0:n.message)?"You don’t have permission to perform this action. Please contact your firm admin.":(null==n?void 0:n.message)||"Unable to create upload record.");let i=function(e){let t=e.replace(/[/\\]/g,"").trim().replace(/[^a-zA-Z0-9._-]/g,"_");return t.length>0?t:"document"}(em.name),d="".concat(w.firmId,"/cases/").concat(eF,"/").concat(l.id,"/").concat(i),{error:o}=await c.N.storage.from("case-documents").upload(d,em,{upsert:!1,contentType:em.type||"application/octet-stream"});if(o){await c.N.from("case_documents").update({deleted_at:new Date().toISOString()}).eq("id",l.id),ec(o.message||"Unable to upload document.");return}let{error:m}=await c.N.from("case_documents").update({storage_path:d,size_bytes:em.size,mime_type:em.type||null}).eq("id",l.id);if(m){await c.N.from("case_documents").update({deleted_at:new Date().toISOString()}).eq("id",l.id),ec(m.message||"Unable to finalize upload.");return}try{await c.N.from("case_activity").insert({firm_id:w.firmId,case_id:eF,actor_user_id:s,event_type:"document_uploaded",message:"Document uploaded: ".concat(em.name),metadata:{file_name:em.name}})}catch(e){}eu(null),await eA(),await eO()}catch(e){ec(e instanceof Error?e.message:"Unable to upload document.")}finally{ed(!1)}},eZ=async e=>{eg(e),M(null);try{let t=E.find(t=>t.id===e);if(!(null==t?void 0:t.storage_path))return void M("Document is missing a storage path.");let{data:a,error:r}=await c.N.storage.from("case-documents").createSignedUrl(t.storage_path,60);if(r||!(null==a?void 0:a.signedUrl))return void M((null==r?void 0:r.message)||"Unable to generate download link.");window.open(a.signedUrl,"_blank","noopener,noreferrer")}catch(e){M(e instanceof Error?e.message:"Unable to download document.")}finally{eg(null)}},eH=async e=>{if(F(null),A(null),!eU)return void A("You don’t have permission to perform this action. Please contact your firm admin.");let t=H.split(",").map(e=>e.trim()).filter(e=>e.length>0),a=E.find(t=>t.id===e),{error:r}=await c.N.from("case_documents").update({display_name:B.trim()||null,doc_type:J,tags:t}).eq("id",e);if(r)return void A(eY(r.message)?"You don’t have permission to perform this action. Please contact your firm admin.":r.message);T(a=>a.map(a=>a.id===e?{...a,display_name:B.trim()||null,doc_type:J,tags:t}:a)),a&&w.firmId&&((a.display_name||a.filename)!==B.trim()&&await (0,x.M)(c.N,{firm_id:w.firmId,case_id:eF,actor_user_id:w.userId,event_type:"document_renamed",message:"Document renamed: ".concat(a.display_name||a.filename," → ").concat(B.trim()),metadata:{document_id:e}}),(a.doc_type!==J||a.tags.join(",")!==t.join(","))&&await (0,x.M)(c.N,{firm_id:w.firmId,case_id:eF,actor_user_id:w.userId,event_type:"document_updated",message:"Document updated: ".concat(B.trim()||a.filename),metadata:{document_id:e}})),F("Saved"),z(null)},eK=async e=>{var t;if(F(null),A(null),!eq)return void A("You don’t have permission to perform this action. Please contact your firm admin.");if(!window.confirm("Delete this document? This cannot be undone."))return;let{data:a,error:r}=await c.N.auth.getSession();if(r||!(null==(t=a.session)?void 0:t.access_token))return void A((null==r?void 0:r.message)||"Please sign in.");let s=await fetch("/api/myclient/documents/delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a.session.access_token)},body:JSON.stringify({documentId:e})}),l=await s.json().catch(()=>({}));if(!s.ok||!l.ok)return void A(eY(l.error)?"You don’t have permission to perform this action. Please contact your firm admin.":l.error||"Unable to delete document.");T(t=>t.filter(t=>t.id!==e)),F("Deleted"),await eO()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l(),{children:(0,r.jsx)("title",{children:"MyClient | Case Detail"})}),(0,r.jsxs)("div",{className:"mx-auto max-w-6xl rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-8 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsx)(i(),{href:"/myclient/cases",className:"text-sm text-[color:var(--muted)] hover:text-white transition",children:"← Back to Active Cases"}),(0,r.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold text-white",children:"Case Detail"}),k&&(0,r.jsx)("span",{className:"rounded-full border px-3 py-1 text-xs uppercase tracking-wide ".concat(null!=(e=f[k.status.toLowerCase()])?e:"border-white/15 text-[color:var(--muted)]"),children:k.status})]})]}),w.loading&&(0,r.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Loading..."}),!w.loading&&!w.authed&&(0,r.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Please sign in."}),!w.loading&&w.authed&&!w.firmId&&(0,r.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"No firm linked yet."}),C&&(0,r.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Loading..."}),!C&&w.authed&&w.firmId&&!k&&!D&&(0,r.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Case not found."}),k&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mt-6 rounded-2xl border border-[color:var(--border)] bg-[var(--surface-0)] p-6",children:(0,r.jsx)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:(0,r.jsx)("div",{children:(()=>{var e,t;let{displayName:a,subtitle:s}={displayName:(e=k).client_last_name||e.client_first_name?"".concat(null!=(t=e.client_last_name)?t:"").concat(e.client_first_name?", ".concat(e.client_first_name):"").trim():e.title||e.client_name,subtitle:[e.matter_type,[e.county,e.state].filter(Boolean).join(", "),e.case_number?"Case #".concat(e.case_number):null].filter(Boolean).join(" • ")};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:"text-3xl font-semibold text-white",children:a}),(0,r.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:s||"Case details"})]})})()})})}),(0,r.jsx)("div",{className:"mt-6 border-b border-[color:var(--border)] text-sm text-[color:var(--muted)]",children:[{key:"overview",label:"Overview"},{key:"notes",label:"Notes"},{key:"documents",label:"Documents"},{key:"tasks",label:"Tasks"},{key:"activity",label:"Activity"}].map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>e_(e.key),className:"mr-6 border-b-2 pb-3 transition ".concat(eb===e.key?"border-[color:var(--accent-light)] text-white":"border-transparent hover:text-white"),children:e.label},e.key))}),"overview"===eb&&(0,r.jsxs)("div",{className:"mt-6 grid gap-6 md:grid-cols-2",children:[(0,r.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-[var(--surface-0)] p-5",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Client"}),(0,r.jsxs)("div",{className:"mt-3 space-y-2 text-sm text-[color:var(--text-2)]",children:[(0,r.jsxs)("p",{children:["First name: ",(0,r.jsx)("span",{className:"text-white",children:null!=(t=k.client_first_name)?t:"—"})]}),(0,r.jsxs)("p",{children:["Last name: ",(0,r.jsx)("span",{className:"text-white",children:null!=(a=k.client_last_name)?a:"—"})]}),(0,r.jsxs)("p",{children:["Email: ",(0,r.jsx)("span",{className:"text-white",children:null!=(s=k.client_email)?s:"—"})]}),(0,r.jsxs)("p",{children:["Phone: ",(0,r.jsx)("span",{className:"text-white",children:null!=(n=k.client_phone)?n:"—"})]})]})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-[var(--surface-0)] p-5",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Matter"}),(0,r.jsxs)("div",{className:"mt-3 space-y-2 text-sm text-[color:var(--text-2)]",children:[(0,r.jsxs)("p",{children:["Matter type: ",(0,r.jsx)("span",{className:"text-white",children:k.matter_type})]}),(0,r.jsxs)("p",{children:["Status: ",(0,r.jsx)("span",{className:"text-white",children:k.status})]}),(0,r.jsxs)("p",{children:["Created: ",(0,r.jsx)("span",{className:"text-white",children:new Date(k.created_at).toLocaleString()})]}),(0,r.jsxs)("p",{children:["Last updated: ",(0,r.jsx)("span",{className:"text-white",children:new Date(k.updated_at).toLocaleString()})]})]})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-[var(--surface-0)] p-5",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Jurisdiction"}),(0,r.jsxs)("div",{className:"mt-3 space-y-2 text-sm text-[color:var(--text-2)]",children:[(0,r.jsxs)("p",{children:["State: ",(0,r.jsx)("span",{className:"text-white",children:null!=(v=k.state)?v:"—"})]}),(0,r.jsxs)("p",{children:["County: ",(0,r.jsx)("span",{className:"text-white",children:null!=(g=k.county)?g:"—"})]}),(0,r.jsxs)("p",{children:["Court: ",(0,r.jsx)("span",{className:"text-white",children:null!=(b=k.court_name)?b:"—"})]}),(0,r.jsxs)("p",{children:["Case number: ",(0,r.jsx)("span",{className:"text-white",children:null!=(_=k.case_number)?_:"—"})]})]})]})]}),"notes"===eb&&(0,r.jsxs)("div",{className:"mt-6 rounded-2xl border border-white/10 bg-[var(--surface-0)] p-5",children:[(0,r.jsx)("textarea",{value:ey,onChange:e=>ew(e.target.value),rows:8,readOnly:!eT,className:"w-full rounded-lg border border-white/10 bg-[var(--surface-1)] px-4 py-3 text-sm text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"}),(0,r.jsx)("p",{className:"mt-3 text-xs text-[color:var(--text-2)]",children:eT?null!=eN?eN:"Autosave enabled.":"Read-only access."})]}),"documents"===eb&&(0,r.jsxs)("div",{className:"mt-6 rounded-2xl border border-white/10 bg-[var(--surface-0)] p-6",children:[L&&(0,r.jsx)("div",{className:"mb-4 rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:L}),O&&(0,r.jsx)("div",{className:"mb-4 rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:O}),Y&&(0,r.jsx)("div",{className:"mb-4 rounded-lg border border-white/10 bg-[var(--surface-1)] px-4 py-2 text-sm text-white",children:Y}),(0,r.jsx)("div",{className:"grid gap-4",children:U?(0,r.jsx)("p",{className:"text-sm text-[color:var(--text-2)]",children:"Loading documents..."}):0===E.length?(0,r.jsx)("p",{className:"text-sm text-[color:var(--text-2)]",children:"No documents uploaded yet."}):(0,r.jsx)("ul",{className:"divide-y divide-white/10",children:E.map(e=>(0,r.jsxs)("li",{className:"flex flex-col gap-2 py-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-white",children:e.display_name||e.filename}),(0,r.jsxs)("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-xs text-[color:var(--text-2)]",children:[(0,r.jsx)("span",{className:"rounded-full border border-white/15 px-2 py-0.5 uppercase tracking-wide",children:e.doc_type}),e.tags.length>0&&(0,r.jsxs)("span",{children:[e.tags.slice(0,2).join(", "),e.tags.length>2?" +".concat(e.tags.length-2):""]})]}),(0,r.jsx)("p",{className:"text-xs text-[color:var(--text-2)]",children:new Date(e.created_at).toLocaleString()})]}),(0,r.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:R===e.id?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{value:B,onChange:e=>X(e.target.value),disabled:!eU,className:"w-full rounded-md border border-white/10 bg-[var(--surface-1)] px-2 py-1 text-xs text-white outline-none",placeholder:"Display name"}),(0,r.jsx)("input",{value:J,onChange:e=>Z(e.target.value),disabled:!eU,className:"w-full rounded-md border border-white/10 bg-[var(--surface-1)] px-2 py-1 text-xs text-white outline-none",placeholder:"Type"}),(0,r.jsx)("input",{value:H,onChange:e=>K(e.target.value),disabled:!eU,className:"w-full rounded-md border border-white/10 bg-[var(--surface-1)] px-2 py-1 text-xs text-white outline-none",placeholder:"Tags (comma separated)"}),(0,r.jsx)("button",{onClick:()=>eH(e.id),disabled:!eU,className:"rounded-lg border border-white/15 px-3 py-2 text-xs font-semibold uppercase tracking-wide text-[color:var(--text-2)] hover:text-white",children:"Save"}),(0,r.jsx)("button",{onClick:()=>z(null),className:"rounded-lg border border-white/10 px-3 py-2 text-xs uppercase tracking-wide text-[color:var(--text-2)] hover:text-white",children:"Cancel"})]}):(0,r.jsxs)(r.Fragment,{children:[eU&&(0,r.jsx)("button",{onClick:()=>{z(e.id),X(e.display_name||e.filename),Z(e.doc_type||"other"),K(e.tags.join(", ")),F(null),A(null)},className:"rounded-lg border border-white/15 px-3 py-2 text-xs font-semibold uppercase tracking-wide text-[color:var(--text-2)] hover:text-white",children:"Rename/Edit"}),(0,r.jsx)("button",{onClick:()=>eZ(e.id),disabled:ev===e.id,className:"rounded-lg border border-white/15 px-3 py-2 text-xs font-semibold uppercase tracking-wide text-[color:var(--text-2)] hover:text-white disabled:opacity-60",children:ev===e.id?"Preparing…":"Download"}),eq&&(0,r.jsx)("button",{onClick:()=>eK(e.id),className:"rounded-lg border border-red-400/40 px-3 py-2 text-xs font-semibold uppercase tracking-wide text-red-200 hover:text-white",children:"Delete"})]})})]},e.id))})}),(0,r.jsxs)("div",{className:"mt-6 rounded-xl border border-white/10 bg-[var(--surface-1)] p-4",children:[(0,r.jsx)("p",{className:"text-sm text-[color:var(--text-2)]",children:"Upload a document (PDF, image, or doc)."}),eM&&(0,r.jsxs)("div",{className:"mt-3 rounded-lg border border-white/10 bg-[var(--surface-0)] px-3 py-2 text-sm text-[color:var(--text-2)]",children:[eL.reason," Upgrade to Pro to upload more documents.",(0,r.jsx)(i(),{href:"/myclient/upgrade",className:"ml-2 text-white underline underline-offset-4",children:"Upgrade"})]}),(0,r.jsxs)("div",{className:"mt-3 flex flex-col gap-3 sm:flex-row sm:items-center",children:[(0,r.jsx)("input",{type:"file",onChange:e=>{var t,a;return eu(null!=(a=null==(t=e.target.files)?void 0:t[0])?a:null)},disabled:!eU||eM||eh,className:"w-full text-sm text-[color:var(--text-2)] file:mr-4 file:rounded-lg file:border-0 file:bg-[var(--surface-0)] file:px-4 file:py-2 file:text-xs file:font-semibold file:text-white"}),(0,r.jsx)("button",{onClick:eJ,disabled:ei||!em||!eU||eM||eh,className:"rounded-lg bg-[color:var(--accent-light)] px-4 py-2 text-sm font-semibold text-white hover:bg-[color:var(--accent)] disabled:opacity-60",children:ei?"Uploading…":"Upload"})]}),!eU&&(0,r.jsx)("p",{className:"mt-3 text-sm text-[color:var(--text-2)]",children:"You have read-only access. Please contact your firm admin to upload documents."}),eo&&(0,r.jsx)("p",{className:"mt-3 text-sm text-red-200",children:eo})]})]}),"tasks"===eb&&(0,r.jsxs)("div",{className:"mt-6 space-y-6",children:[el&&(0,r.jsx)("div",{className:"rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:el}),!eT&&(0,r.jsx)("p",{className:"text-sm text-[color:var(--text-2)]",children:"Read-only access to tasks."}),eT&&(0,r.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-[var(--surface-0)] p-4",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Add task"}),(0,r.jsxs)("div",{className:"mt-3 grid gap-3 sm:grid-cols-[2fr_1fr_auto]",children:[(0,r.jsx)("input",{value:et,onChange:e=>ea(e.target.value),placeholder:"Task title",className:"w-full rounded-lg border border-white/10 bg-[var(--surface-1)] px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"}),(0,r.jsx)("input",{type:"date",value:er,onChange:e=>es(e.target.value),className:"w-full rounded-lg border border-white/10 bg-[var(--surface-1)] px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"}),(0,r.jsx)("button",{onClick:eB,className:"rounded-lg bg-[color:var(--accent-light)] px-4 py-2 text-sm font-semibold text-white hover:bg-[color:var(--accent)]",children:"Add"})]})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-[var(--surface-0)] p-4",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Open tasks"}),V?(0,r.jsx)("p",{className:"mt-3 text-sm text-[color:var(--text-2)]",children:"Loading tasks..."}):0===G.filter(e=>"open"===e.status).length?(0,r.jsx)("p",{className:"mt-3 text-sm text-[color:var(--text-2)]",children:"No open tasks."}):(0,r.jsx)("ul",{className:"mt-3 space-y-2 text-sm text-[color:var(--text-2)]",children:G.filter(e=>"open"===e.status).map(e=>(0,r.jsxs)("li",{className:"flex flex-col gap-2 rounded-lg border border-white/10 bg-[var(--surface-1)] px-3 py-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-white",children:e.title}),e.due_date&&(0,r.jsxs)("p",{className:"text-xs",children:["Due ",new Date(e.due_date).toLocaleDateString()]})]}),eT&&(0,r.jsx)("button",{onClick:()=>eX(e,"done"),className:"rounded-lg border border-white/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-wide text-[color:var(--text-2)] hover:text-white",children:"Mark done"})]},e.id))})]}),(0,r.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-[var(--surface-0)] p-4",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Completed"}),0===G.filter(e=>"done"===e.status).length?(0,r.jsx)("p",{className:"mt-3 text-sm text-[color:var(--text-2)]",children:"No completed tasks."}):(0,r.jsx)("ul",{className:"mt-3 space-y-2 text-sm text-[color:var(--text-2)]",children:G.filter(e=>"done"===e.status).map(e=>(0,r.jsxs)("li",{className:"flex flex-col gap-2 rounded-lg border border-white/10 bg-[var(--surface-1)] px-3 py-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-white",children:e.title}),e.completed_at&&(0,r.jsxs)("p",{className:"text-xs",children:["Completed ",new Date(e.completed_at).toLocaleDateString()]})]}),eT&&(0,r.jsx)("button",{onClick:()=>eX(e,"open"),className:"rounded-lg border border-white/15 px-3 py-1.5 text-xs font-semibold uppercase tracking-wide text-[color:var(--text-2)] hover:text-white",children:"Reopen"})]},e.id))})]}),$&&(0,r.jsx)("div",{className:"rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:$})]}),"activity"===eb&&(0,r.jsxs)("div",{className:"mt-6 rounded-2xl border border-white/10 bg-[var(--surface-0)] p-6",children:[eP&&(0,r.jsx)("div",{className:"mb-4 rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:eP}),eI?(0,r.jsx)("p",{className:"text-sm text-[color:var(--text-2)]",children:"Loading activity…"}):0===eS.length?(0,r.jsx)("p",{className:"text-sm text-[color:var(--text-2)]",children:"No activity yet."}):(0,r.jsx)("ul",{className:"space-y-4",children:eS.map(e=>{let t="case_created"===e.event_type?"Created":"case_updated"===e.event_type?"Updated":"Document";return(0,r.jsx)("li",{className:"rounded-xl border border-white/10 bg-[var(--surface-1)] p-4",children:(0,r.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-white",children:e.message}),(0,r.jsx)("p",{className:"text-xs text-[color:var(--text-2)]",children:new Date(e.created_at).toLocaleString()})]}),(0,r.jsx)("span",{className:"rounded-full border border-white/15 px-2 py-1 text-xs uppercase tracking-wide text-[color:var(--text-2)]",children:t})]})},e.id)})})]})]}),D&&(0,r.jsx)("div",{className:"mt-6 rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:D})]})]})}},9845:(e,t,a)=>{"use strict";async function r(e,t){try{var a,r,s;await e.from("case_activity").insert({firm_id:t.firm_id,case_id:null!=(a=t.case_id)?a:null,actor_user_id:null!=(r=t.actor_user_id)?r:null,event_type:t.event_type,message:t.message,metadata:null!=(s=t.metadata)?s:{}})}catch(e){}}a.d(t,{M:()=>r})}},e=>{e.O(0,[636,593,792],()=>e(e.s=945)),_N_E=e.O()}]);