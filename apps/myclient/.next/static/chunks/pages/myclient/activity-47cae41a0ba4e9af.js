(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[517],{1320:(e,t,r)=>{"use strict";function a(e){if("string"!=typeof e)return null;let t=e.toLowerCase();return"admin"===t||"attorney"===t||"staff"===t?t:null}function s(e){let t=a(e);return"admin"===t||"attorney"===t}function l(e){let t=a(e);return"admin"===t||"attorney"===t}function c(e){let t=a(e);return"admin"===t||"attorney"===t}function i(e){return"admin"===a(e)}r.d(t,{TX:()=>l,Ue:()=>s,gL:()=>c,jR:()=>i})},2226:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var a=r(6029),s=r(5669),l=r.n(s),c=r(2203),i=r.n(c),n=r(5729),d=r(8638),o=r(5054),m=r(1320);let u=[{value:7,label:"Last 7 days"},{value:30,label:"Last 30 days"},{value:90,label:"Last 90 days"}];function x(){let{state:e}=(0,d._)(),[t,r]=(0,n.useState)(90),[s,c]=(0,n.useState)([]),[x,f]=(0,n.useState)(!1),[h,v]=(0,n.useState)(null),p=(0,m.jR)(e.role),y=(0,n.useMemo)(()=>{let e=new Date;return e.setDate(e.getDate()-t),e.toISOString()},[t]);(0,n.useEffect)(()=>{if(!e.authed||!e.firmId)return;let t=!0;return(async()=>{f(!0),v(null);let{data:r,error:a}=await o.N.from("case_activity").select("id, case_id, actor_user_id, event_type, message, created_at").eq("firm_id",e.firmId).gte("created_at",y).order("created_at",{ascending:!1}).limit(200);t&&(a?(v(a.message),c([])):c(null!=r?r:[]),f(!1))})(),()=>{t=!1}},[e.authed,e.firmId,y]);let g=async()=>{if(!e.firmId||!p)return;let{data:r,error:a}=await o.N.from("case_activity").select("created_at, event_type, message, case_id, actor_user_id").eq("firm_id",e.firmId).gte("created_at",y).order("created_at",{ascending:!1}).limit(1e3);if(a)return void v(a.message);let s=["created_at","event_type","message","case_id","actor_user_id"],l=new Blob([[s.join(","),...(null!=r?r:[]).map(e=>s.map(t=>{let r=e[t],a=null==r?"":String(r);return'"'.concat(a.replace(/"/g,'""'),'"')}).join(","))].join("\n")],{type:"text/csv"}),c=URL.createObjectURL(l),i=document.createElement("a");i.href=c,i.download="verilex-activity-".concat(t,"d.csv"),i.click(),URL.revokeObjectURL(c)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l(),{children:(0,a.jsx)("title",{children:"MyClient | Activity"})}),(0,a.jsxs)("div",{className:"mx-auto max-w-6xl rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-8 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsx)(i(),{href:"/myclient/app",className:"text-sm text-[color:var(--muted)] hover:text-white transition",children:"â† Back"}),(0,a.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Activity"})]}),(0,a.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"Recent firm activity and exports."}),!e.authed&&(0,a.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Please sign in."}),e.authed&&!e.firmId&&(0,a.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"No firm linked yet."}),e.authed&&e.firmId&&!p&&(0,a.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Admin only. Contact your admin for access."}),e.authed&&e.firmId&&p&&(0,a.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsx)("label",{htmlFor:"rangeDays",className:"sr-only",children:"Select date range"}),(0,a.jsx)("select",{id:"rangeDays",value:t,onChange:e=>r(Number(e.target.value)),className:"rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:u.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,a.jsx)("button",{onClick:g,className:"rounded-lg border border-[color:var(--border)] px-4 py-2 text-xs font-semibold uppercase tracking-wide text-[color:var(--muted)] hover:text-white",children:"Export CSV"})]}),h&&(0,a.jsx)("div",{className:"rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:h}),(0,a.jsx)("div",{className:"overflow-hidden rounded-2xl border border-[color:var(--border)]",children:x?(0,a.jsx)("p",{className:"px-4 py-6 text-[color:var(--muted)]",children:"Loading..."}):0===s.length?(0,a.jsx)("p",{className:"px-4 py-6 text-[color:var(--muted)]",children:"No activity for this range."}):(0,a.jsx)("ul",{className:"divide-y divide-white/10",children:s.map(e=>(0,a.jsx)("li",{className:"px-4 py-4",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{children:[e.case_id?(0,a.jsx)(i(),{href:"/myclient/cases/".concat(e.case_id),className:"text-white hover:text-[color:var(--accent-soft)]",children:e.message}):(0,a.jsx)("p",{className:"text-white",children:e.message}),(0,a.jsx)("p",{className:"text-xs text-[color:var(--muted-2)]",children:new Date(e.created_at).toLocaleString()})]}),(0,a.jsx)("span",{className:"rounded-full border border-[color:var(--border)] px-2 py-1 text-xs uppercase tracking-wide text-[color:var(--muted)]",children:e.event_type})]})},e.id))})})]})]})]})}},2489:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/myclient/activity",function(){return r(2226)}])},5669:(e,t,r)=>{e.exports=r(4807)}},e=>{e.O(0,[636,593,792],()=>e(e.s=2489)),_N_E=e.O()}]);