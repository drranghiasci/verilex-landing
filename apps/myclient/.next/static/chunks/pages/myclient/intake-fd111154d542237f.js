(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[338],{1320:(e,t,r)=>{"use strict";function a(e){if("string"!=typeof e)return null;let t=e.toLowerCase();return"admin"===t||"attorney"===t||"staff"===t?t:null}function l(e){let t=a(e);return"admin"===t||"attorney"===t}function o(e){let t=a(e);return"admin"===t||"attorney"===t}function n(e){let t=a(e);return"admin"===t||"attorney"===t}function s(e){return"admin"===a(e)}r.d(t,{TX:()=>o,Ue:()=>l,gL:()=>n,jR:()=>s})},3668:(e,t,r)=>{"use strict";r.d(t,{b:()=>s});var a=r(5729),l=r(5054),o=r(8638);let n="free";function s(){let{state:e}=(0,o._)(),[t,r]=(0,a.useState)({plan:n,loading:!0,error:null}),s=(0,a.useCallback)(async()=>{var t;if(!e.authed||!e.firmId)return void r({plan:n,loading:!1,error:null});r(e=>({...e,loading:!0,error:null}));let{data:a,error:o}=await l.N.from("firms").select("plan").eq("id",e.firmId).single();if(o)return void r({plan:n,loading:!1,error:o.message});r({plan:null!=(t=null==a?void 0:a.plan)?t:n,loading:!1,error:null})},[e.authed,e.firmId]);return(0,a.useEffect)(()=>{s()},[s]),t}},5737:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/myclient/intake",function(){return r(8423)}])},6660:(e,t,r)=>{"use strict";r.d(t,{HK:()=>a,Z8:()=>o,nh:()=>s,wq:()=>n});let a={free:{maxCases:25,maxMembers:3,maxDocuments:200},pro:null,enterprise:null};function l(e){return null===a[e]}function o(e){return l(e.plan)?{ok:!0}:e.currentCaseCount>=a[e.plan].maxCases?{ok:!1,reason:"Case limit reached for Free plan (".concat(a[e.plan].maxCases,").")}:{ok:!0}}function n(e){return l(e.plan)?{ok:!0}:e.currentMemberCount>=a[e.plan].maxMembers?{ok:!1,reason:"Member limit reached for Free plan (".concat(a[e.plan].maxMembers,").")}:{ok:!0}}function s(e){return l(e.plan)?{ok:!0}:e.currentDocumentCount>=a[e.plan].maxDocuments?{ok:!1,reason:"Document limit reached for Free plan (".concat(a[e.plan].maxDocuments,").")}:{ok:!0}}},8423:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var a=r(6029),l=r(5669),o=r.n(l),n=r(2203),s=r.n(n),i=r(1278),c=r(5729),u=r(8638),d=r(5054),m=r(1195);let x=m.Ik({client_first_name:m.Yj().trim().min(1,"Client first name is required."),client_last_name:m.Yj().trim().min(1,"Client last name is required."),client_email:m.Yj().trim().email("Enter a valid email.").optional().or(m.eu("")),client_phone:m.Yj().trim().optional().or(m.eu("")),title:m.Yj().trim().optional().or(m.eu("")),matter_type:m.Yj().trim().optional().default("Divorce"),status:m.Yj().trim().optional().default("open"),state:m.Yj().trim().optional().or(m.eu("")),county:m.Yj().trim().optional().or(m.eu("")),court_name:m.Yj().trim().optional().or(m.eu("")),case_number:m.Yj().trim().optional().or(m.eu("")),internal_notes:m.Yj().trim().optional().or(m.eu(""))});function f(e){var t,r;let a=(null!=(t=e.title)?t:"").trim();if(a)return a;let l=(null!=(r=e.matter_type)?r:"").trim()||"Matter";return"".concat(e.client_last_name,", ").concat(e.client_first_name," — ").concat(l)}var p=r(1320),v=r(3668),b=r(6660);let g=["open","paused","closed"];function h(){var e;let t=(0,i.useRouter)(),{state:r}=(0,u._)(),{plan:l,loading:n}=(0,v.b)(),[m,h]=(0,c.useState)(""),[j,N]=(0,c.useState)(""),[_,y]=(0,c.useState)(""),[k,w]=(0,c.useState)(""),[C,S]=(0,c.useState)("Divorce"),[I,Y]=(0,c.useState)("open"),[P,D]=(0,c.useState)(""),[E,M]=(0,c.useState)(!1),[q,U]=(0,c.useState)(""),[F,L]=(0,c.useState)(""),[T,O]=(0,c.useState)(""),[R,X]=(0,c.useState)(""),[B,J]=(0,c.useState)(""),[Z,z]=(0,c.useState)(!1),[A,H]=(0,c.useState)(null),[K,W]=(0,c.useState)({}),[G,Q]=(0,c.useState)(null),[V,$]=(0,c.useState)(!1),ee=(0,p.Ue)(r.role),et=!!(r.authed&&r.firmId&&!ee),er=null===G?{ok:!0}:(0,b.Z8)({plan:l,currentCaseCount:G}),ea=!n&&null!==G&&!er.ok;(0,c.useEffect)(()=>{if(E)return;if(!m.trim()&&!j.trim())return void D("");let e=f({client_first_name:m,client_last_name:j,matter_type:C,title:"",status:I,client_email:_,client_phone:k,state:q,county:F,court_name:T,case_number:R,internal_notes:B});D(e)},[F,T,_,m,E,j,C,B,k,R,q,I]),(0,c.useEffect)(()=>{if(!r.authed||!r.firmId)return;let e=!0;return(async()=>{$(!0);let{count:t,error:a}=await d.N.from("cases").select("id",{count:"exact",head:!0}).eq("firm_id",r.firmId);e&&(a?Q(null):Q(null!=t?t:0),$(!1))})(),()=>{e=!1}},[r.authed,r.firmId]);let el=async e=>{var a,l;if(e.preventDefault(),H(null),W({}),!r.firmId)return void H("No firm linked yet.");if(!ee)return void H("You don’t have permission to perform this action. Please contact your firm admin.");if(ea)return void H("".concat(er.reason," Upgrade to Pro to add more cases."));let o=x.safeParse({client_first_name:m,client_last_name:j,client_email:_,client_phone:k,title:P,matter_type:C,status:I,state:q,county:F,court_name:T,case_number:R,internal_notes:B});if(!o.success){let e={};o.error.errors.forEach(t=>{"client_first_name"===t.path[0]&&(e.firstName=t.message),"client_last_name"===t.path[0]&&(e.lastName=t.message)}),W(e),H((null==(a=o.error.errors[0])?void 0:a.message)||"Please check the intake fields.");return}z(!0);try{let e=o.data,r=f(e),{data:a,error:n}=await d.N.auth.getSession();if(n||!(null==(l=a.session)?void 0:l.access_token))return void H((null==n?void 0:n.message)||"Please sign in to create a case.");let s=await fetch("/api/myclient/cases/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a.session.access_token)},body:JSON.stringify({client_first_name:e.client_first_name,client_last_name:e.client_last_name,client_email:e.client_email||null,client_phone:e.client_phone||null,title:r,matter_type:e.matter_type||"Divorce",status:e.status||"open",state:e.state||null,county:e.county||null,court_name:e.court_name||null,case_number:e.case_number||null,internal_notes:e.internal_notes||null})}),i=await s.json().catch(()=>({}));if(!s.ok||!i.ok){let e=i.error||"Unable to create case.";H((e=>{if(!e)return!1;let t=e.toLowerCase();return t.includes("permission")||t.includes("policy")||t.includes("not allowed")})(e)?"You don’t have permission to perform this action. Please contact your firm admin.":e);return}t.push("/myclient/cases/".concat(i.caseId))}catch(e){H(e instanceof Error?e.message:"Unable to create case.")}finally{z(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o(),{children:(0,a.jsx)("title",{children:"MyClient | New Case Intake"})}),(0,a.jsxs)("div",{className:"mx-auto max-w-6xl rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-8 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsx)(s(),{href:"/myclient/app",className:"text-sm text-[color:var(--muted)] hover:text-white transition",children:"← Back"}),(0,a.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"New Case Intake"})]}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:["Firm ",r.firmId?r.firmId.slice(0,8):"No firm"," \xb7 Role ",null!=(e=r.role)?e:"member"]}),r.loading&&(0,a.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Loading..."}),!r.loading&&!r.authed&&(0,a.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Please sign in."}),!r.loading&&r.authed&&!r.firmId&&(0,a.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"No firm linked yet."}),r.authed&&r.firmId&&(0,a.jsxs)("form",{onSubmit:el,className:"mt-8 space-y-8",children:[et&&(0,a.jsx)("div",{className:"rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-sm text-[color:var(--muted)]",children:"You have read-only access. Please contact your firm admin to create a case."}),ea&&(0,a.jsxs)("div",{className:"rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-sm text-[color:var(--muted)]",children:[er.reason," Upgrade to Pro to add more cases.",(0,a.jsx)(s(),{href:"/myclient/upgrade",className:"ml-2 text-white underline underline-offset-4",children:"Upgrade"})]}),A&&(0,a.jsx)("div",{className:"rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-3 text-sm text-red-200",children:A}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,a.jsxs)("section",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Client Information"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-[color:var(--muted)]",children:"Who is this case for?"})]}),(0,a.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,a.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["First name *",(0,a.jsx)("input",{value:m,onChange:e=>h(e.target.value),disabled:et,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]",required:!0}),K.firstName&&(0,a.jsx)("span",{className:"mt-1 block text-xs text-red-300",children:K.firstName})]}),(0,a.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["Last name *",(0,a.jsx)("input",{value:j,onChange:e=>N(e.target.value),disabled:et,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]",required:!0}),K.lastName&&(0,a.jsx)("span",{className:"mt-1 block text-xs text-red-300",children:K.lastName})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Contact"}),(0,a.jsxs)("div",{className:"mt-3 grid gap-4 sm:grid-cols-2",children:[(0,a.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["Email (optional)",(0,a.jsx)("input",{type:"email",value:_,onChange:e=>y(e.target.value),disabled:et,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,a.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["Phone (optional)",(0,a.jsx)("input",{type:"tel",value:k,onChange:e=>w(e.target.value),disabled:et,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]})]})]})]}),(0,a.jsxs)("section",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Matter Details"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-[color:var(--muted)]",children:"Define the case type and tracking basics."})]}),(0,a.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["Matter type",(0,a.jsx)("input",{value:C,onChange:e=>S(e.target.value),disabled:et,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,a.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["Status",(0,a.jsx)("select",{value:I,onChange:e=>Y(e.target.value),disabled:et,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:g.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["Matter title (optional)",(0,a.jsx)("input",{value:P,onChange:e=>{var t;D(t=e.target.value),M(t.trim().length>0)},disabled:et,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"}),(0,a.jsx)("span",{className:"mt-2 block text-xs text-[color:var(--muted-2)]",children:"Default title is generated from client + matter type."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Jurisdiction"}),(0,a.jsxs)("div",{className:"mt-3 grid gap-4 sm:grid-cols-2",children:[(0,a.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["State (optional)",(0,a.jsx)("input",{value:q,onChange:e=>U(e.target.value),disabled:et,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,a.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["County (optional)",(0,a.jsx)("input",{value:F,onChange:e=>L(e.target.value),disabled:et,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,a.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["Court name (optional)",(0,a.jsx)("input",{value:T,onChange:e=>O(e.target.value),disabled:et,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,a.jsxs)("label",{className:"block text-sm text-[color:var(--muted)]",children:["Case number (optional)",(0,a.jsx)("input",{value:R,onChange:e=>X(e.target.value),disabled:et,className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]})]})]})]})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Intake Summary"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-[color:var(--muted)]",children:"Capture key details for your team."}),(0,a.jsx)("textarea",{value:B,onChange:e=>J(e.target.value),disabled:et,rows:5,className:"mt-3 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-3 text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsx)("button",{type:"submit",disabled:Z||et||ea||V,className:"rounded-lg bg-[color:var(--accent-light)] px-5 py-2.5 text-sm font-semibold text-white hover:bg-[color:var(--accent)] disabled:opacity-60",children:Z?"Creating…":"Create Case"}),(0,a.jsx)("p",{className:"text-xs text-[color:var(--muted-2)]",children:"Your data is secured and isolated to your firm."})]})]})]})]})}}},e=>{e.O(0,[724,636,593,792],()=>e(e.s=5737)),_N_E=e.O()}]);