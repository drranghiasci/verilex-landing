(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[973],{1320:(e,t,r)=>{"use strict";function l(e){if("string"!=typeof e)return null;let t=e.toLowerCase();return"admin"===t||"attorney"===t||"staff"===t?t:null}function a(e){let t=l(e);return"admin"===t||"attorney"===t}function o(e){let t=l(e);return"admin"===t||"attorney"===t}function s(e){let t=l(e);return"admin"===t||"attorney"===t}function n(e){return"admin"===l(e)}r.d(t,{TX:()=>o,Ue:()=>a,gL:()=>s,jR:()=>n})},5669:(e,t,r)=>{e.exports=r(4807)},7159:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/myclient/cases",function(){return r(7583)}])},7583:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var l=r(6029),a=r(5669),o=r.n(a),s=r(2203),n=r.n(s),c=r(5729),i=r(8638),d=r(5054),u=r(1320),m=r(9440);let x=["open","paused","closed"];function v(e){var t;let{open:r,onClose:a,caseRow:o,role:s,onSaved:n}=e,[i,v]=(0,c.useState)(""),[b,f]=(0,c.useState)(""),[p,h]=(0,c.useState)(""),[g,y]=(0,c.useState)(""),[j,w]=(0,c.useState)(""),[_,N]=(0,c.useState)(""),[C,S]=(0,c.useState)(""),[k,E]=(0,c.useState)("open"),[L,T]=(0,c.useState)(!1),[I,M]=(0,c.useState)(null),[P,A]=(0,c.useState)(null),D=(0,u.Ue)(s);if((0,c.useEffect)(()=>{var e,t,r,l,a,s,n,c;o&&(v(null!=(e=o.title)?e:""),f(null!=(t=o.client_first_name)?t:""),h(null!=(r=o.client_last_name)?r:""),y(null!=(l=o.client_email)?l:""),w(null!=(a=o.client_phone)?a:""),N(null!=(s=o.state)?s:""),S(null!=(n=o.county)?n:""),E(null!=(c=o.status)?c:"open"),M(null),A(null))},[o,r]),(0,c.useEffect)(()=>{if(!r)return;let e=e=>{"Escape"===e.key&&a()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[r,a]),!r||!o)return null;let F=async()=>{if(M(null),A(null),!D)return void M("You don’t have permission to perform this action. Please contact your firm admin.");if(!i.trim()||!b.trim()||!p.trim())return void M("Title, first name, and last name are required.");T(!0);try{var e;let{data:t,error:r}=await d.N.auth.getSession();if(r||!(null==(e=t.session)?void 0:e.access_token))return void M((null==r?void 0:r.message)||"Please sign in.");let l=await fetch("/api/myclient/cases/update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.session.access_token)},body:JSON.stringify({id:o.id,title:i.trim(),client_first_name:b.trim(),client_last_name:p.trim(),client_email:g.trim()||null,client_phone:j.trim()||null,state:_.trim()||null,county:C.trim()||null,status:k})}),s=await l.json().catch(()=>({}));if(!l.ok||!s.ok){let e=s.error||"Unable to update case.",t=String(e).toLowerCase();M(t.includes("permission")||t.includes("policy")||t.includes("not allowed")?"You don’t have permission to perform this action. Please contact your firm admin.":e);return}let c={...o,title:i.trim(),client_first_name:b.trim(),client_last_name:p.trim(),client_email:g.trim()||null,client_phone:j.trim()||null,state:_.trim()||null,county:C.trim()||null,status:k};n(c),A("Saved"),a()}catch(e){M(e instanceof Error?e.message:"Unable to update case.")}finally{T(!1)}};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{type:"button","aria-label":"Close edit case",onClick:a,className:"fixed inset-0 z-40 bg-black/40 backdrop-blur-[1px]"}),(0,l.jsx)("aside",{className:"fixed right-0 top-16 z-50 h-[calc(100vh-64px)] w-full max-w-[420px] border-l border-[color:var(--border)] bg-[var(--surface-0)] shadow-2xl",children:(0,l.jsxs)("div",{className:"flex h-full flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between border-b border-[color:var(--border)] px-5 py-4",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Edit Case"}),(0,l.jsx)("button",{type:"button","aria-label":"Close edit",onClick:a,className:"rounded-lg border border-[color:var(--border)] p-1.5 text-[color:var(--muted)] hover:text-white",children:(0,l.jsx)(m.A,{className:"h-4 w-4"})})]}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto px-5 py-6",children:(0,l.jsxs)("div",{className:"space-y-4 text-sm",children:[I&&(0,l.jsx)("div",{className:"rounded-lg border border-red-400/30 bg-red-500/10 px-3 py-2 text-red-200",children:I}),P&&(0,l.jsx)("div",{className:"rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white",children:P}),(0,l.jsxs)("label",{className:"block text-[color:var(--muted)]",children:["Matter title",(0,l.jsx)("input",{value:i,onChange:e=>v(e.target.value),className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,l.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,l.jsxs)("label",{className:"block text-[color:var(--muted)]",children:["First name",(0,l.jsx)("input",{value:b,onChange:e=>f(e.target.value),className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,l.jsxs)("label",{className:"block text-[color:var(--muted)]",children:["Last name",(0,l.jsx)("input",{value:p,onChange:e=>h(e.target.value),className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]})]}),(0,l.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,l.jsxs)("label",{className:"block text-[color:var(--muted)]",children:["Email",(0,l.jsx)("input",{type:"email",value:g,onChange:e=>y(e.target.value),className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,l.jsxs)("label",{className:"block text-[color:var(--muted)]",children:["Phone",(0,l.jsx)("input",{value:j,onChange:e=>w(e.target.value),className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]})]}),(0,l.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,l.jsxs)("label",{className:"block text-[color:var(--muted)]",children:["State",(0,l.jsx)("input",{value:_,onChange:e=>N(e.target.value),className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]}),(0,l.jsxs)("label",{className:"block text-[color:var(--muted)]",children:["County",(0,l.jsx)("input",{value:C,onChange:e=>S(e.target.value),className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]"})]})]}),(0,l.jsxs)("label",{className:"block text-[color:var(--muted)]",children:["Status",(0,l.jsx)("select",{value:k,onChange:e=>E(e.target.value),className:"mt-2 w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-white outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:x.map(e=>(0,l.jsx)("option",{value:e,children:e},e))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-[color:var(--muted)]",children:"Notes preview"}),(0,l.jsx)("textarea",{value:null!=(t=o.internal_notes)?t:"",readOnly:!0,rows:4,className:"mt-2 w-full resize-none rounded-lg border border-[color:var(--border)] bg-[var(--surface-1)] px-3 py-2 text-[color:var(--muted)]"})]})]})}),(0,l.jsx)("div",{className:"border-t border-[color:var(--border)] px-5 py-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,l.jsx)("button",{type:"button",onClick:a,className:"rounded-lg border border-[color:var(--border)] px-4 py-2 text-sm font-semibold text-[color:var(--muted)] hover:text-white",children:"Cancel"}),(0,l.jsx)("button",{type:"button",onClick:F,disabled:L||!D,className:"rounded-lg bg-[color:var(--accent-light)] px-5 py-2 text-sm font-semibold text-white hover:bg-[color:var(--accent)] disabled:opacity-60",children:L?"Saving…":"Save changes"})]})})]})})]})}let b=[{value:"all",label:"All"},{value:"open",label:"Open"},{value:"paused",label:"Paused"},{value:"closed",label:"Closed"}],f=[{value:"last_activity",label:"Last activity"},{value:"newest",label:"Newest"},{value:"client_last",label:"Client last name"}],p={open:"border-emerald-400/40 text-emerald-200",paused:"border-amber-400/40 text-amber-200",closed:"border-slate-400/40 text-slate-200"};function h(){var e;let{state:t}=(0,i._)(),[r,a]=(0,c.useState)([]),[s,m]=(0,c.useState)(!1),[x,h]=(0,c.useState)(null),[g,y]=(0,c.useState)(""),[j,w]=(0,c.useState)("all"),[_,N]=(0,c.useState)("all"),[C,S]=(0,c.useState)("all"),[k,E]=(0,c.useState)("last_activity"),[L,T]=(0,c.useState)(!1),[I,M]=(0,c.useState)(null),P=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,[r,l]=(0,c.useState)(e);return(0,c.useEffect)(()=>{let r=setTimeout(()=>l(e),t);return()=>clearTimeout(r)},[e,t]),r}(g),A=(0,u.Ue)(t.role),D=null!=(e=t.role)?e:null,F=(0,c.useMemo)(()=>t.firmId?t.firmId.slice(0,8):"No firm",[t.firmId]);(0,c.useEffect)(()=>{if(!t.authed||!t.firmId)return;let e=!0;return(async()=>{m(!0),h(null);let{data:r,error:l}=await d.N.from("cases").select("id, title, client_first_name, client_last_name, client_email, client_phone, status, matter_type, county, state, case_number, last_activity_at, created_at, internal_notes").eq("firm_id",t.firmId).order("last_activity_at",{ascending:!1}).limit(200);e&&(l?(h(l.message),a([])):a(null!=r?r:[]),m(!1))})(),()=>{e=!1}},[t.authed,t.firmId]);let U=(0,c.useMemo)(()=>Array.from(new Set(r.map(e=>e.state).filter(e=>!!e))).sort(),[r]),O=(0,c.useMemo)(()=>Array.from(new Set(r.filter(e=>"all"===_||e.state===_).map(e=>e.county).filter(e=>!!e))).sort(),[r,_]),z=(0,c.useMemo)(()=>{let e=P.trim().toLowerCase(),t=[...r.filter(t=>{var r;return("all"===j||(null!=(r=t.status)?r:"").toLowerCase()===j)&&("all"===_||t.state===_)&&("all"===C||t.county===C)&&(!e||!![t.title,t.client_first_name,t.client_last_name,t.case_number].filter(Boolean).join(" ").toLowerCase().includes(e))&&!0})];return t.sort((e,t)=>{if("newest"===k){let r=e.created_at?new Date(e.created_at).getTime():0;return(t.created_at?new Date(t.created_at).getTime():0)-r}if("client_last"===k){let r=e.client_last_name||e.title||"",l=t.client_last_name||t.title||"";return r.localeCompare(l)}let r=e.last_activity_at||e.created_at,l=t.last_activity_at||t.created_at,a=r?new Date(r).getTime():0;return(l?new Date(l).getTime():0)-a}),t},[r,C,P,k,_,j]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o(),{children:(0,l.jsx)("title",{children:"MyClient | Cases"})}),(0,l.jsxs)("div",{className:"mx-auto max-w-6xl rounded-2xl border border-[color:var(--border)] bg-[var(--surface-1)] p-8 shadow-sm",children:[(0,l.jsx)("div",{className:"sticky top-6 z-10 -mx-8 mb-6 border-b border-[color:var(--border)] bg-[var(--surface-1)] px-8 pb-6 pt-2",children:(0,l.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-end lg:justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(n(),{href:"/myclient/app",className:"text-sm text-[color:var(--muted)] hover:text-white transition",children:"← Back"}),(0,l.jsx)("h1",{className:"mt-3 text-3xl font-semibold text-white",children:"Active Cases"}),(0,l.jsxs)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:["Firm ",F]})]}),(0,l.jsxs)("div",{className:"flex w-full flex-col gap-3 lg:w-auto lg:min-w-[360px]",children:[(0,l.jsx)("input",{value:g,onChange:e=>y(e.target.value),placeholder:"Search by client, title, or case number",className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-2 text-sm text-[color:var(--text)] placeholder:text-[color:var(--muted-2)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]"}),(0,l.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,l.jsx)("select",{"aria-label":"Filter by status",value:j,onChange:e=>w(e.target.value),className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:b.map(e=>(0,l.jsxs)("option",{value:e.value,children:["Status: ",e.label]},e.value))}),(0,l.jsx)("select",{"aria-label":"Sort cases by",value:k,onChange:e=>E(e.target.value),className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:f.map(e=>(0,l.jsxs)("option",{value:e.value,children:["Sort: ",e.label]},e.value))})]}),(0,l.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,l.jsxs)("select",{"aria-label":"Filter by state",value:_,onChange:e=>{N(e.target.value),S("all")},className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:[(0,l.jsx)("option",{value:"all",children:"State: All"}),U.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]}),(0,l.jsxs)("select",{title:"Filter by county",value:C,onChange:e=>S(e.target.value),className:"w-full rounded-lg border border-[color:var(--border)] bg-[var(--surface-0)] px-3 py-2 text-sm text-[color:var(--text)] outline-none focus:ring-2 focus:ring-[color:var(--accent)]",children:[(0,l.jsx)("option",{value:"all",children:"County: All"}),O.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]})]}),(0,l.jsx)("button",{type:"button",onClick:()=>{y(""),w("all"),N("all"),S("all"),E("last_activity")},disabled:!g.trim()&&"all"===j&&"all"===_&&"all"===C&&"last_activity"===k,className:"w-full rounded-lg border border-[color:var(--border)] px-3 py-2 text-xs font-semibold uppercase tracking-wide text-[color:var(--muted)] hover:text-white disabled:cursor-not-allowed disabled:opacity-50",children:"Clear filters"})]})]})}),t.loading&&(0,l.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Loading..."}),!t.loading&&!t.authed&&(0,l.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"Please sign in."}),!t.loading&&t.authed&&!t.firmId&&(0,l.jsx)("p",{className:"mt-6 text-[color:var(--muted)]",children:"No firm linked yet."}),x&&(0,l.jsx)("div",{className:"mt-6 rounded-lg border border-red-400/30 bg-red-500/10 px-4 py-2 text-sm text-red-200",children:x}),t.authed&&t.firmId&&(0,l.jsx)("div",{className:"space-y-4",children:s?(0,l.jsx)("p",{className:"text-[color:var(--muted)]",children:"Loading..."}):0===z.length?(0,l.jsxs)("div",{className:"rounded-2xl border border-[color:var(--border)] bg-[var(--surface-0)] p-8 text-center",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-white",children:"No cases match your filters."}),(0,l.jsx)("p",{className:"mt-2 text-sm text-[color:var(--muted)]",children:"Start a new case intake to populate your dashboard."}),(0,l.jsx)(n(),{href:"/myclient/intake",className:"mt-4 inline-flex items-center justify-center rounded-lg bg-[color:var(--accent-light)] px-4 py-2 text-sm font-semibold text-white hover:bg-[color:var(--accent)]",children:"New Case Intake"})]}):z.map(e=>{var t,r,a;let{displayName:o,subtitle:s}=function(e){var t;let r=e.client_last_name||e.client_first_name?"".concat(null!=(t=e.client_last_name)?t:"").concat(e.client_first_name?", ".concat(e.client_first_name):"").trim():e.title||"Untitled case",l=[e.county,e.state].filter(Boolean).join(", ");return{displayName:r,subtitle:[e.matter_type,l,e.case_number?"Case #".concat(e.case_number):null].filter(Boolean).join(" • ")}}(e),c=null!=(r=p[(null!=(t=e.status)?t:"").toLowerCase()])?r:"border-white/15 text-[color:var(--muted)]",i=null!=(a=e.status)?a:"Unknown";return(0,l.jsx)("div",{className:"rounded-2xl border border-[color:var(--border)] bg-[var(--surface-0)] px-4 py-4 transition hover:bg-white/5",children:(0,l.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,l.jsx)(n(),{href:"/myclient/cases/".concat(e.id),className:"flex-1",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-base font-semibold text-white",children:o}),(0,l.jsx)("p",{className:"mt-1 text-xs text-[color:var(--muted-2)]",children:s||"No details yet"})]})}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("span",{className:"rounded-full border px-2 py-1 text-xs uppercase tracking-wide ".concat(c),children:i}),(0,l.jsx)("span",{className:"text-xs text-[color:var(--muted-2)]",children:function(e){if(!e)return"—";let t=new Date,r=new Date(e),l=Math.floor((t.getTime()-r.getTime())/6e4);if(l<1)return"Just now";if(l<60)return"".concat(l,"m ago");let a=Math.floor(l/60);if(a<24)return"".concat(a,"h ago");let o=Math.floor(a/24);return o<30?"".concat(o,"d ago"):r.toLocaleDateString()}(e.last_activity_at||e.created_at)}),A?(0,l.jsx)("button",{type:"button",onClick:()=>{M(e),T(!0)},className:"rounded-lg border border-[color:var(--border)] px-3 py-1.5 text-xs font-semibold uppercase tracking-wide text-[color:var(--muted)] hover:text-white",children:"Edit"}):(0,l.jsx)("span",{className:"text-xs text-[color:var(--muted-2)]",children:"View only"})]})]})},e.id)})}),(0,l.jsx)(v,{open:L,onClose:()=>T(!1),caseRow:I,role:D,onSaved:e=>{a(t=>t.map(t=>t.id===e.id?{...t,...e}:t))}})]})]})}}},e=>{e.O(0,[636,593,792],()=>e(e.s=7159)),_N_E=e.O()}]);